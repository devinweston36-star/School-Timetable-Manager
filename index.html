<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Timetable Manager (Shareable)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7cc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a1a1aa; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-backdrop { animation: fadeIn 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        /* =========================================================================
           [ë°°í¬ ê°€ì´ë“œ]
           1. ì•±ì—ì„œ ì‹œê°„í‘œë¥¼ ëª¨ë‘ ì‘ì„±í•©ë‹ˆë‹¤.
           2. 'Data / File' ë©”ë‰´ -> 'Danger Zone' -> 'ë°°í¬ìš© ë°ì´í„° ë³µì‚¬' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤.
           3. ë³µì‚¬ëœ í…ìŠ¤íŠ¸ë¥¼ ì•„ë˜ 'PRELOADED_DATA = null;' ì˜ null ëŒ€ì‹  ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
           4. ì €ì¥ í›„ ì´ HTML íŒŒì¼ì„ ë°°í¬í•˜ë©´, í•´ë‹¹ ë°ì´í„°ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.
           =========================================================================
        */
        const PRELOADED_DATA = null; 


        const { useState, useEffect, useMemo, useCallback } = React;
        
        const START_HOUR = 13; 
        const END_HOUR = 22;   

        const Icon = ({ path, size = 18, className = "" }) => (
          <svg className={`w-${size/4} h-${size/4} ${className}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width={size} height={size}>
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={path} />
          </svg>
        );

        const STORAGE_KEYS = {
            RAW_INPUT: 'stm_raw_input',
            CLASSES: 'stm_classes',
            ROOMS: 'stm_rooms',
            PREFS: 'stm_instructor_prefs'
        };

        const ICONS = {
            calendar: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
            clock: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
            users: "M17 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H9a2 2 0 00-2 2v2a2 2 0 002 2h2m-4-6a4 4 0 11-8 0 4 4 0 018 0zM12 14c-1.105 0-2-.895-2-2v-1h4v1c0 1.105-.895 2-2 2z",
            bookOpen: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 4 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 3.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",
            trash2: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",
            plus: "M12 4v16m8-8H4",
            save: "M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4",
            barChart2: "M18 20V10M12 20V4M6 20v-6",
            monitor: "M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z",
            alertCircle: "M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
            xCircle: "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
            edit2: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-11-2l2 2m-2-2l-2 2m4 4l-4 4m2 0l2 2m-2-2l2 2m-4 4l2-2m-2 2l-2-2m4 4l-2 2",
            x: "M6 18L18 6M6 6l12 12",
            check: "M5 13l4 4L19 7",
            palette: "M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01",
            wand2: "M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z",
            settings: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",
            table: "M3 10h18M3 14h18m-9-4v8m-7.5-8v8m15-8v8M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z",
            download: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",
            layout: "M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z",
            code: "M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4",
            fileText: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6 M16 13H8 M16 17H8 M10 9H8"
        };

        const PASTEL_PALETTE = [
            '#FFD1DC', '#FFDFD3', '#FFFFD1', '#E2F0CB', '#B5EAD7', '#C7CEEA', 
            '#F0E68C', '#E6E6FA', '#FFB6C1', '#ADD8E6', '#90EE90', '#FFDEAD', 
            '#D8BFD8', '#FFEFD5', '#FFE4E1', '#E0FFFF', '#FAFAD2', '#D3D3D3' 
        ];

        const DAYS = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
        const DAY_MAP = {
            'ì›”': 'Monday', 'í™”': 'Tuesday', 'ìˆ˜': 'Wednesday', 'ëª©': 'Thursday', 
            'ê¸ˆ': 'Friday', 'í† ': 'Saturday', 'ì¼': 'Sunday'
        };

        // --- DayTimetable Component (ì‹œê°„í‘œ ë Œë”ë§) ---
        const DayTimetable = React.memo(({ day, rooms, classes, onAssignRoom, getClassStyle, fullWidth = false }) => {
            const dayClasses = classes.filter(c => c.day === day && c.roomId);
            const totalMinutes = (END_HOUR - START_HOUR) * 60;
            
            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden h-full">
                    <div className="p-3 bg-gray-50 border-b border-gray-100 font-bold text-gray-700 flex justify-between items-center">
                        <span>{DAY_MAP[day]} ({day})</span>
                        {fullWidth && <span className="text-xs text-gray-400 font-normal">{START_HOUR}:00 - {END_HOUR}:00</span>}
                    </div>
                    
                    <div className="flex-1 overflow-x-auto overflow-y-auto p-2 relative">
                        <div className="min-w-[600px]" style={{ minWidth: fullWidth ? '100%' : '600px' }}>
                            {/* Header */}
                            <div className="flex border-b-2 border-gray-200 pb-2 mb-2 sticky top-0 bg-white z-10">
                                <div className="w-12 flex-shrink-0"></div> 
                                {rooms.map(room => (
                                    <div key={room} className="flex-1 text-center font-bold text-gray-700 text-sm truncate px-1">
                                        {room}
                                    </div>
                                ))}
                            </div>

                            {/* Grid Body */}
                            <div className="relative" style={{ height: '500px' }}>
                                {/* Time Markers */}
                                {Array.from({ length: (END_HOUR - START_HOUR) + 1 }).map((_, i) => {
                                    const hour = START_HOUR + i;
                                    const topPct = (i / (END_HOUR - START_HOUR)) * 100;
                                    return (
                                        <div key={i} className="absolute w-full flex items-center pointer-events-none" style={{ top: `${topPct}%` }}>
                                            <div className="w-12 text-xs text-gray-400 text-right pr-2 -mt-2">{hour}:00</div>
                                            <div className="flex-1 h-px bg-gray-100"></div>
                                        </div>
                                    );
                                })}

                                {/* Class Blocks */}
                                <div className="absolute top-0 left-12 right-0 bottom-0 flex">
                                    {rooms.map(room => {
                                        const roomClasses = dayClasses.filter(c => c.roomId === room);
                                        return (
                                            <div key={room} className="flex-1 relative border-l border-gray-50 h-full mx-1">
                                                {roomClasses.map(cls => {
                                                    const startOffset = cls.startMin - (START_HOUR * 60);
                                                    if (startOffset < 0) return null;

                                                    const topPct = (startOffset / totalMinutes) * 100;
                                                    const heightPct = ((cls.duration * 60) / totalMinutes) * 100;
                                                    const style = getClassStyle(cls);
                                                    
                                                    return (
                                                        <div
                                                            key={cls.id}
                                                            className="absolute w-full px-1 rounded shadow-sm overflow-hidden text-[10px] hover:z-20 hover:scale-105 transition-transform cursor-pointer border-l-2 flex flex-col justify-center group"
                                                            style={{ 
                                                                top: `${topPct}%`, 
                                                                height: `${heightPct}%`,
                                                                maxHeight: `${heightPct}%`,
                                                                backgroundColor: style.backgroundColor, 
                                                                borderLeftColor: style.borderColor,
                                                                color: style.color
                                                            }}
                                                            title={`${cls.level} by ${cls.instructor} (${cls.startTime}-${cls.endTime})`}
                                                            onClick={() => onAssignRoom(cls.id, null)}
                                                        >
                                                            <div className="font-bold truncate">{cls.level}</div>
                                                            <div className="truncate opacity-75">{cls.instructor}</div>
                                                            <div className="truncate text-[9px] hidden sm:block">{cls.startTime}-{cls.endTime}</div>
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        });

        // --- ClassCard Component ---
        const ClassCard = React.memo(({ cls, compact = false, isEditing, editForm, onEditStart, onEditCancel, onEditSave, onEditChange, onAssignRoom, onDeleteClass, rooms, getClassStyle }) => {
            const style = getClassStyle(cls);
            if (isEditing) {
              return (
                <div className="p-3 rounded-lg border-2 border-indigo-500 bg-white shadow-lg text-sm space-y-2">
                  <div className="flex justify-between items-center mb-1">
                     <span className="text-xs font-bold text-indigo-600">Editing Mode</span>
                     <div className="flex gap-1">
                       <button onClick={onEditSave} className="p-1 bg-green-100 text-green-700 rounded hover:bg-green-200"><Icon path={ICONS.check} size={14}/></button>
                       <button onClick={onEditCancel} className="p-1 bg-red-100 text-red-700 rounded hover:bg-red-200"><Icon path={ICONS.x} size={14}/></button>
                     </div>
                  </div>
                  <div>
                    <label className="block text-[10px] font-bold text-gray-500">Level</label>
                    <input className="w-full p-1 border rounded text-xs" value={editForm.level || ''} onChange={e => onEditChange('level', e.target.value)} />
                  </div>
                  <div className="grid grid-cols-2 gap-2">
                    <div>
                      <label className="block text-[10px] font-bold text-gray-500">Instructor</label>
                      <input className="w-full p-1 border rounded text-xs" value={editForm.instructor || ''} onChange={e => onEditChange('instructor', e.target.value)} />
                    </div>
                    <div>
                      <label className="block text-[10px] font-bold text-gray-500">Students</label>
                      <input className="w-full p-1 border rounded text-xs" type="number" value={editForm.count || 0} onChange={e => onEditChange('count', e.target.value)} />
                    </div>
                  </div>
                  <div className="grid grid-cols-3 gap-1">
                    <div>
                      <label className="block text-[10px] font-bold text-gray-500">Day</label>
                      <select className="w-full p-1 border rounded text-xs" value={editForm.day} onChange={e => onEditChange('day', e.target.value)}>
                        {DAYS.map(d => <option key={d} value={d}>{d}</option>)}
                      </select>
                    </div>
                    <div className="col-span-2 grid grid-cols-2 gap-1">
                       <input type="time" className="w-full p-1 border rounded text-xs" value={editForm.startTime} onChange={e => onEditChange('startTime', e.target.value)} />
                       <input type="time" className="w-full p-1 border rounded text-xs" value={editForm.endTime} onChange={e => onEditChange('endTime', e.target.value)} />
                    </div>
                  </div>
                </div>
              );
            }
            return (
              <div className="p-3 rounded-lg border-l-4 shadow-sm text-sm transition-all hover:shadow-md relative group bg-white" style={{ backgroundColor: style.backgroundColor, borderLeftColor: style.borderColor, color: style.color }}>
                <button onClick={(e) => { e.stopPropagation(); onEditStart(cls); }} className="absolute top-2 right-8 p-1 rounded bg-white/50 hover:bg-white text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm" title="Edit Class"><Icon path={ICONS.edit2} size={12} /></button>
                <button onClick={(e) => { e.stopPropagation(); onDeleteClass(cls.id); }} className="absolute top-2 right-2 p-1 rounded bg-white/50 hover:bg-red-50 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm" title="Delete Class"><Icon path={ICONS.trash2} size={12} /></button>
                <div className="flex justify-between items-start mb-1 pr-10">
                  <div className="flex items-center gap-2 flex-wrap">
                    <span className="font-bold">{cls.level}</span>
                    <span className="px-1.5 py-0.5 rounded text-xs font-bold bg-white/60 border border-black/10 shadow-sm">{cls.day}</span>
                  </div>
                  <span className="text-xs bg-white/60 px-1 rounded border border-black/10">{cls.studentType}</span>
                </div>
                <div className="flex items-center gap-2 text-xs opacity-90 mb-1"><Icon path={ICONS.clock} size={12} />{cls.startTime} - {cls.endTime}</div>
                <div className="flex justify-between items-center text-xs">
                  <span className="font-medium flex items-center gap-1"><Icon path={ICONS.users} size={12} /> {cls.instructor}</span>
                  <span className="bg-white/60 px-1.5 rounded-full text-[10px] border border-black/10">{cls.count} stds</span>
                </div>
                {!compact && (
                  <div className="mt-3 pt-2 border-t border-black/10">
                    <label className="block text-xs font-semibold opacity-70 mb-1">Assign Room:</label>
                    <select className="w-full p-1 text-xs border rounded bg-white/80 focus:ring-2 focus:ring-indigo-400 outline-none text-gray-800" value={cls.roomId || ""} onChange={(e) => onAssignRoom(cls.id, e.target.value || null)}>
                      <option value="">-- Unassigned --</option>
                      {rooms.map(r => <option key={r} value={r}>{r}</option>)}
                    </select>
                  </div>
                )}
              </div>
            );
        });

        // --- Main App Component ---
        const App = () => {
          // State
          const [viewMode, setViewMode] = useState('dashboard');
          
          const [rawInput, setRawInput] = useState(() => {
              if (localStorage.getItem(STORAGE_KEYS.RAW_INPUT)) return localStorage.getItem(STORAGE_KEYS.RAW_INPUT);
              if (PRELOADED_DATA && PRELOADED_DATA.rawInput) return PRELOADED_DATA.rawInput;
              return "CDI_ë‚´ì‹ (ë™ì•„ìœ¤1)_ì›”5(M) (17:00~19:00) [6ëª…] Nahyun Kang\nC2D_Albatross_ì›”7(M) (19:00~22:00) [3ëª…] Olivia Constable\nCDI_Birdie_í™”5(E) (16:00~18:30) [8ëª…] John Doe\nTO_Originator_í™”7(M)_1 (19:00~22:00) [4ëª…] Jane Smith";
          });

          const [classes, setClasses] = useState(() => {
              const saved = localStorage.getItem(STORAGE_KEYS.CLASSES);
              if (saved) return JSON.parse(saved);
              if (PRELOADED_DATA && PRELOADED_DATA.classes) return PRELOADED_DATA.classes;
              return [];
          });

          const [rooms, setRooms] = useState(() => {
              const saved = localStorage.getItem(STORAGE_KEYS.ROOMS);
              if (saved) return JSON.parse(saved);
              if (PRELOADED_DATA && PRELOADED_DATA.rooms) return PRELOADED_DATA.rooms;
              return ['401', '402', '403', '404', '405', '406', '407', '601', '602', '603', '605', '606', '607'];
          });

          const [instructorPrefs, setInstructorPrefs] = useState(() => {
              const saved = localStorage.getItem(STORAGE_KEYS.PREFS);
              if (saved) return JSON.parse(saved);
              if (PRELOADED_DATA && PRELOADED_DATA.instructorPrefs) return PRELOADED_DATA.instructorPrefs;
              return {};
          });

          const [newRoomName, setNewRoomName] = useState('');
          const [activeDay, setActiveDay] = useState('ì›”');
          const [parseError, setParseError] = useState(null);
          const [failedLines, setFailedLines] = useState([]);
          
          const [editingClassId, setEditingClassId] = useState(null);
          const [editForm, setEditForm] = useState({});
          const [colorScheme, setColorScheme] = useState('type'); 
          const [showPrefModal, setShowPrefModal] = useState(false);
          const [showClearModal, setShowClearModal] = useState(false);
          const [showImportExportModal, setShowImportExportModal] = useState(false);
          const [toast, setToast] = useState({ show: false, message: '' });

          // Effects
          useEffect(() => { localStorage.setItem(STORAGE_KEYS.RAW_INPUT, rawInput); }, [rawInput]);
          useEffect(() => { localStorage.setItem(STORAGE_KEYS.CLASSES, JSON.stringify(classes)); }, [classes]);
          useEffect(() => { localStorage.setItem(STORAGE_KEYS.ROOMS, JSON.stringify(rooms)); }, [rooms]);
          useEffect(() => { localStorage.setItem(STORAGE_KEYS.PREFS, JSON.stringify(instructorPrefs)); }, [instructorPrefs]);
          useEffect(() => {
            const saveInterval = setInterval(() => { showToast("ğŸ“ ë°ì´í„°ê°€ ë¸Œë¼ìš°ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìë™ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); }, 60000);
            return () => clearInterval(saveInterval);
          }, []);

          const showToast = (msg) => { setToast({ show: true, message: msg }); setTimeout(() => setToast({ show: false, message: '' }), 3000); };
          const confirmReset = () => { localStorage.clear(); window.location.reload(); };

          // Parsing
          const parseData = () => {
            const lines = rawInput.split('\n').filter(line => line.trim() !== '');
            const newClasses = [];
            const failures = [];
            lines.forEach((line, index) => {
              try {
                const timeRegex = /\((\d{1,2}:\d{2})~(\d{1,2}:\d{2})\)/;
                const timeMatch = line.match(timeRegex);
                if (!timeMatch) throw new Error("Time block not found");
                const [_, startTime, endTime] = timeMatch;
                const timeIndex = timeMatch.index;
                const preTime = line.substring(0, timeIndex).trim(); 
                const postTime = line.substring(timeIndex + timeMatch[0].length).trim(); 
                const countMatch = postTime.match(/\[(\d+)ëª…\]/);
                const count = countMatch ? countMatch[1] : "0";
                const instructor = postTime.replace(/\[\d+ëª…\]/, '').trim();
                const parts = preTime.split('_');
                let type = parts[0] || "Unknown";
                let level = "General";
                let day = "";
                let period = "";
                let studentType = "";
                const dayCharRegex = /[ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼]/;
                let dayPartIndex = -1;
                for (let i = parts.length - 1; i >= 0; i--) { if (dayCharRegex.test(parts[i])) { dayPartIndex = i; break; } }
                if (dayPartIndex === -1) throw new Error("Day not found");
                if (dayPartIndex > 0) { if (dayPartIndex > 1) { level = parts.slice(1, dayPartIndex).join('_'); } else { level = parts[1] === parts[dayPartIndex] ? "" : parts[1]; } } else { type = "General"; }
                const dayPartStr = parts[dayPartIndex]; 
                const dayMatch = dayPartStr.match(/([ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼])(\d*)(\(([A-Za-z]+)\))?/);
                if (dayMatch) { day = dayMatch[1]; period = dayMatch[2]; studentType = dayMatch[4] || ""; }
                const sParts = startTime.split(':').map(Number);
                const eParts = endTime.split(':').map(Number);
                const sMin = sParts[0] * 60 + sParts[1];
                const eMin = eParts[0] * 60 + eParts[1];
                const duration = (eMin - sMin) / 60;
                newClasses.push({ id: `cls-${Date.now()}-${index}`, raw: line, type, level: level || type, day, period, studentType, startTime, endTime, startMin: sMin, endMin: eMin, count, instructor, duration, roomId: null });
              } catch (err) { failures.push(line); }
            });
            setClasses(newClasses);
            setFailedLines(failures);
            setParseError(failures.length > 0 ? `${failures.length} lines could not be parsed.` : null);
          };

          // Logic
          const autoAssignClasses = () => {
            let assignedCount = 0; let conflictCount = 0; let noPrefCount = 0; let currentClasses = [...classes];
            const unassigned = currentClasses.filter(c => !c.roomId);
            unassigned.forEach(cls => {
              const prefRoom = instructorPrefs[cls.instructor];
              if (!prefRoom) { noPrefCount++; return; }
              if (!rooms.includes(prefRoom)) { noPrefCount++; return; }
              const hasConflict = currentClasses.some(existing => {
                if (existing.roomId !== prefRoom) return false;
                if (existing.day !== cls.day) return false;
                if (existing.id === cls.id) return false;
                return (cls.startMin < existing.endMin && cls.endMin > existing.startMin);
              });
              if (!hasConflict) {
                const index = currentClasses.findIndex(c => c.id === cls.id);
                if (index !== -1) { currentClasses[index] = { ...currentClasses[index], roomId: prefRoom }; assignedCount++; }
              } else { conflictCount++; }
            });
            showToast(`âœ¨ ìë™ ë°°ì •: ${assignedCount}ê±´ ì™„ë£Œ`);
            setClasses(currentClasses);
          };

          const startEditing = useCallback((cls) => { setEditingClassId(cls.id); setEditForm({ ...cls }); }, []);
          const cancelEditing = useCallback(() => { setEditingClassId(null); setEditForm({}); }, []);
          const saveEditing = useCallback(() => {
            setClasses(prev => prev.map(c => {
              if (c.id === editingClassId) {
                const startParts = editForm.startTime.split(':').map(Number); const endParts = editForm.endTime.split(':').map(Number);
                const sMin = startParts[0] * 60 + startParts[1]; const eMin = endParts[0] * 60 + endParts[1]; const duration = (eMin - sMin) / 60;
                return { ...editForm, startMin: sMin, endMin: eMin, duration };
              }
              return c;
            }));
            setEditingClassId(null); setEditForm({});
          }, [editingClassId, editForm]);
          const handleEditChange = useCallback((field, value) => { setEditForm(prev => ({ ...prev, [field]: value })); }, []);
          const assignRoom = useCallback((classId, roomId) => { setClasses(prev => prev.map(cls => cls.id === classId ? { ...cls, roomId } : cls)); }, []);
          const deleteClass = useCallback((classId) => { if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { setClasses(prev => prev.filter(c => c.id !== classId)); } }, []);

          const generateColor = (str) => { if (!str) return '#FFFFFF'; let hash = 0; for (let i = 0; i < str.length; i++) { hash = str.charCodeAt(i) + ((hash << 5) - hash); } const index = Math.abs(hash % PASTEL_PALETTE.length); return PASTEL_PALETTE[index]; };
          const getClassStyle = useCallback((cls) => {
            let bg = '#ffffff'; let color = '#000000';
            if (colorScheme === 'instructor') { bg = generateColor(cls.instructor); } else if (colorScheme === 'level') { bg = generateColor(cls.level); } else { if (cls.type === 'CDI') { bg = '#eff6ff'; color = '#1e3a8a'; } else { bg = '#ecfdf5'; color = '#064e3b'; } }
            return { backgroundColor: bg, color: color };
          }, [colorScheme]);

          // Copy/Import Functions
          const copyToClipboardWithStyle = () => {
              const timeSlots = [];
              for(let h = START_HOUR; h < END_HOUR; h++) { timeSlots.push({ label: `${h.toString().padStart(2,'0')}:00`, min: h * 60 }); timeSlots.push({ label: `${h.toString().padStart(2,'0')}:30`, min: h * 60 + 30 }); }
              let html = `<table border="1" style="border-collapse: collapse; text-align: center; font-family: sans-serif; font-size: 12px;">`;
              html += `<thead><tr><th style="background-color: #e5e7eb; width: 80px; height: 30px;">ì‹œê°„ / ê°•ì˜ì‹¤</th>`;
              rooms.forEach(r => { html += `<th style="background-color: #e5e7eb; width: 120px;">${r}</th>`; });
              html += `</tr></thead><tbody>`;
              const skipMap = {}; 
              timeSlots.forEach((slot, tIdx) => {
                  html += `<tr><td style="background-color: #f3f4f6; font-weight: bold; height: 30px;">${slot.label}</td>`;
                  rooms.forEach((room, rIdx) => {
                      const mapKey = `${rIdx}-${tIdx}`;
                      if (skipMap[mapKey]) return; 
                      const cls = classes.find(c => c.day === activeDay && c.roomId === room && Math.abs(c.startMin - slot.min) < 1);
                      if (cls) {
                          const rowSpan = Math.ceil(cls.duration * 2); const style = getClassStyle(cls);
                          html += `<td rowspan="${rowSpan}" style="background-color: ${style.backgroundColor}; color: ${style.color}; border: 1px solid #d1d5db; padding: 4px; vertical-align: middle;"><div style="font-weight: bold; font-size: 13px;">${cls.level}</div><div style="font-size: 11px;">${cls.instructor}</div><div style="font-size: 10px; opacity: 0.8;">${cls.studentType} (${cls.count}ëª…)</div></td>`;
                          for(let i = 1; i < rowSpan; i++) { skipMap[`${rIdx}-${tIdx + i}`] = true; }
                      } else { html += `<td style="border: 1px solid #e5e7eb;"></td>`; }
                  });
                  html += `</tr>`;
              });
              html += `</tbody></table>`;
              const blobHtml = new Blob([html], { type: 'text/html' }); const blobText = new Blob(["HTML Format"], { type: 'text/plain' });
              const data = [new ClipboardItem({ "text/html": blobHtml, "text/plain": blobText })];
              navigator.clipboard.write(data).then(() => { showToast(`ğŸ“‹ ${DAY_MAP[activeDay]} ì‹œê°„í‘œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!`); });
          };

          // NEW: Export as Raw String Function
          const exportAsRawString = () => {
              const lines = classes.map(cls => {
                  // Reconstruct: Type_Level_DayPeriod(StudentType) (Start~End) [Countëª…] Instructor
                  return `${cls.type}_${cls.level}_${cls.day}${cls.period || ''}(${cls.studentType}) (${cls.startTime}~${cls.endTime}) [${cls.count}ëª…] ${cls.instructor}`;
              });
              const rawText = lines.join('\n');
              navigator.clipboard.writeText(rawText).then(() => {
                  showToast("ğŸ“ ì›ë³¸ ë¬¸ìì—´ í˜•ì‹ìœ¼ë¡œ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
              });
          };

          // --- NEW: Export Data for Embedding Feature ---
          const copyDataForEmbedding = () => {
              const data = {
                  rawInput,
                  classes,
                  rooms,
                  instructorPrefs
              };
              const jsonString = JSON.stringify(data);
              navigator.clipboard.writeText(jsonString).then(() => {
                  showToast("ğŸ“¦ ë°°í¬ìš© ë°ì´í„°ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! index.html ìƒë‹¨ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
              });
          };

          const addRoom = () => { if (newRoomName.trim() && !rooms.includes(newRoomName.trim())) { setRooms([...rooms, newRoomName.trim()]); setNewRoomName(''); } };
          const removeRoom = (roomName) => { if(confirm(`'${roomName}' ì‚­ì œ?`)) { setRooms(rooms.filter(r => r !== roomName)); setClasses(prev => prev.map(cls => cls.roomId === roomName ? { ...cls, roomId: null } : cls)); } };

          // Derived Vars
          const unassignedClasses = classes.filter(c => !c.roomId);
          const instructorStats = useMemo(() => {
            const stats = {};
            classes.forEach(cls => {
              const name = cls.instructor.trim();
              if (!stats[name]) { stats[name] = { count: 0, hours: 0, classes: [] }; }
              stats[name].count += 1; stats[name].hours += cls.duration; stats[name].classes.push(cls);
            });
            return Object.entries(stats).sort((a, b) => b[1].hours - a[1].hours);
          }, [classes]);
          
          const allInstructors = useMemo(() => { const names = new Set(classes.map(c => c.instructor)); return Array.from(names).sort(); }, [classes]);

          return (
            <div className="min-h-screen bg-gray-100 text-gray-800 font-sans relative">
              {/* Toast & Modals */}
              <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-[100] transition-all duration-300 ${toast.show ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4 pointer-events-none'}`}>
                  <div className="bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg text-sm font-medium flex items-center gap-2"><span>ğŸ’¾</span> {toast.message}</div>
              </div>
              {showClearModal && (
                  <div className="fixed inset-0 z-[999] flex items-center justify-center modal-backdrop">
                      <div className="absolute inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm"></div>
                      <div className="bg-white p-6 rounded-xl shadow-2xl z-10 max-w-md w-full mx-4 border border-gray-200 relative">
                          <h2 className="text-xl font-bold text-red-600 mb-2 flex items-center gap-2"><Icon path={ICONS.alertCircle} size={24} /> ê²½ê³ : ë°ì´í„° ì´ˆê¸°í™”</h2>
                          <p className="text-gray-600 mb-6">ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.</p>
                          <div className="flex justify-end gap-3"><button onClick={() => setShowClearModal(false)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">ì·¨ì†Œ</button><button onClick={confirmReset} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors shadow-md">ì´ˆê¸°í™”</button></div>
                      </div>
                  </div>
              )}
              {/* Import/Export Modal */}
              {showImportExportModal && (
                  <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                      <div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={() => setShowImportExportModal(false)}></div>
                      <div className="bg-white w-full max-w-2xl rounded-xl shadow-2xl z-10 flex flex-col max-h-[85vh]">
                          <div className="p-4 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-xl">
                              <h2 className="font-bold text-lg text-indigo-800 flex items-center gap-2"><Icon path={ICONS.table} size={20} /> ë°ì´í„° ë‚´ë³´ë‚´ê¸° / ê´€ë¦¬</h2>
                              <button onClick={() => setShowImportExportModal(false)} className="p-1 hover:bg-indigo-100 rounded-full text-indigo-400"><Icon path={ICONS.x} size={20} /></button>
                          </div>
                          <div className="p-6 overflow-y-auto">
                              
                              <div className="mb-6">
                                  <h3 className="text-sm font-bold text-gray-700 mb-2">1. ìŠ¤ë§ˆíŠ¸ ì—‘ì…€ ë‚´ë³´ë‚´ê¸° (ì¶”ì²œ)</h3>
                                  <p className="text-xs text-gray-500 mb-3">{DAY_MAP[activeDay]} ì‹œê°„í‘œë¥¼ ì„œì‹(ìƒ‰ìƒ, ë³‘í•©) í¬í•¨í•˜ì—¬ ë³µì‚¬í•©ë‹ˆë‹¤.</p>
                                  <button onClick={copyToClipboardWithStyle} className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium shadow-sm transition-colors"><Icon path={ICONS.download} size={16} /> ì—‘ì…€ìš© ë³µì‚¬í•˜ê¸°</button>
                              </div>

                              <hr className="my-6 border-gray-100" />

                              <div className="mb-6">
                                  <h3 className="text-sm font-bold text-gray-700 mb-2">2. ë¬¸ìì—´ë¡œ ë‚´ë³´ë‚´ê¸° (ë°±ì—…ìš©)</h3>
                                  <p className="text-xs text-gray-500 mb-3">í˜„ì¬ ì‹œê°„í‘œ ë°ì´í„°ë¥¼ íŒŒì‹± ê°€ëŠ¥í•œ ì›ë³¸ ë¬¸ìì—´ í˜•íƒœë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.</p>
                                  <button onClick={exportAsRawString} className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg text-sm font-medium shadow-sm transition-colors"><Icon path={ICONS.fileText} size={16} /> ì›ë³¸ ë¬¸ìì—´ ë³µì‚¬í•˜ê¸°</button>
                              </div>

                              <hr className="my-6 border-gray-100" />

                              {/* Danger Zone */}
                              <div className="mb-2 bg-red-50 border border-red-200 rounded-lg p-4 relative overflow-hidden">
                                  <div className="absolute top-0 left-0 w-1 h-full bg-red-400"></div>
                                  <h3 className="text-sm font-bold text-red-800 mb-2 flex items-center gap-2">
                                      <Icon path={ICONS.alertCircle} size={16} /> Danger Zone: ë°°í¬ìš© ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                                  </h3>
                                  <p className="text-xs text-red-600 mb-3 leading-relaxed">
                                      <strong>ê³ ê¸‰ ì‚¬ìš©ì ì „ìš© ê¸°ëŠ¥ì…ë‹ˆë‹¤.</strong><br/>
                                      í˜„ì¬ ìƒíƒœë¥¼ ì½”ë“œë¡œ ë³€í™˜í•©ë‹ˆë‹¤. HTML íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì •í•˜ì—¬ ë°°í¬í•  ë•Œë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
                                  </p>
                                  <button onClick={copyDataForEmbedding} className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 border border-red-300 rounded-lg text-sm font-medium shadow-sm transition-colors">
                                      <Icon path={ICONS.code} size={16} /> ë°°í¬ìš© ì½”ë“œ ë³µì‚¬
                                  </button>
                              </div>
                          </div>
                      </div>
                  </div>
              )}
              {showPrefModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4">
                  <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]">
                    <div className="p-4 border-b border-gray-200 flex justify-between items-center"><h2 className="font-bold text-lg flex items-center gap-2"><span className="text-indigo-600"><Icon path={ICONS.settings} size={20} /></span> Preferred Classrooms</h2><button onClick={() => setShowPrefModal(false)} className="p-1 hover:bg-gray-100 rounded-full"><Icon path={ICONS.x} size={20} className="text-gray-500" /></button></div>
                    <div className="p-4 overflow-y-auto flex-1">
                      {allInstructors.length === 0 ? <p className="text-center text-gray-400 py-8">ì •ë³´ ì—†ìŒ</p> : <div className="space-y-3">{allInstructors.map(name => (<div key={name} className="flex justify-between items-center text-sm border p-2 rounded bg-gray-50"><span className="font-medium text-gray-800">{name}</span><select className="border rounded p-1.5 w-40 text-sm bg-white" value={instructorPrefs[name] || ""} onChange={(e) => setInstructorPrefs(prev => ({ ...prev, [name]: e.target.value }))}><option value="">-- None --</option>{rooms.map(r => <option key={r} value={r}>{r}</option>)}</select></div>))}</div>}
                    </div>
                    <div className="p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end gap-2"><button onClick={() => setShowPrefModal(false)} className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors">Done</button></div>
                  </div>
                </div>
              )}

              {/* --- Header --- */}
              <header className="bg-indigo-700 text-white p-4 shadow-md sticky top-0 z-50">
                <div className="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
                  <div className="flex items-center gap-4">
                    <div className="flex items-center gap-2">
                        <Icon path={ICONS.bookOpen} size={24} />
                        <h1 className="text-xl font-bold">School Timetable Manager</h1>
                    </div>
                    
                    <div className="flex bg-indigo-900/50 rounded-lg p-1">
                        <button onClick={() => setViewMode('dashboard')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'dashboard' ? 'bg-white text-indigo-700 shadow-sm' : 'text-indigo-200 hover:text-white'}`}>Dashboard</button>
                        <button onClick={() => setViewMode('weekly')} className={`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${viewMode === 'weekly' ? 'bg-white text-indigo-700 shadow-sm' : 'text-indigo-200 hover:text-white'}`}>Weekly View</button>
                    </div>
                  </div>
                  
                  <div className="flex items-center gap-3 text-sm">
                     <button onClick={() => setShowClearModal(true)} className="flex items-center gap-1 bg-red-500/20 border border-red-400/50 hover:bg-red-500/40 px-3 py-1.5 rounded-lg transition-colors text-red-100"><Icon path={ICONS.trash2} size={14} /><span className="hidden sm:inline">Clear</span></button>
                     <button onClick={() => setShowImportExportModal(true)} className="flex items-center gap-1 bg-green-600 border border-green-500 hover:bg-green-500 px-3 py-1.5 rounded-lg transition-colors"><Icon path={ICONS.table} size={14} /><span>Data / File</span></button>
                     <div className="h-6 w-px bg-indigo-500 mx-1 hidden sm:block"></div>
                     <div className="flex items-center gap-2 bg-indigo-800 rounded-lg p-1 px-2">
                        <Icon path={ICONS.palette} size={14} className="text-indigo-200" />
                        <select value={colorScheme} onChange={(e) => setColorScheme(e.target.value)} className="bg-indigo-900 text-white border-none rounded text-xs p-1 focus:ring-0 cursor-pointer outline-none"><option value="type">Type</option><option value="instructor">Teacher</option><option value="level">Level</option></select>
                     </div>
                     <button onClick={() => setShowPrefModal(true)} className="flex items-center gap-1 bg-indigo-600 border border-indigo-500 hover:bg-indigo-500 px-3 py-1.5 rounded-lg transition-colors"><Icon path={ICONS.settings} size={14} /></button>
                  </div>
                </div>
              </header>

              <main className="max-w-7xl mx-auto p-4">
                {viewMode === 'dashboard' && (
                    <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                        <div className="lg:col-span-3 space-y-6">
                          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                            <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-2"><Icon path={ICONS.monitor} size={18} /> Raw Data Input</h2>
                            <textarea className="w-full h-40 p-3 text-xs font-mono border rounded-md focus:ring-2 focus:ring-indigo-500 outline-none resize-none bg-slate-50" placeholder="Paste strings here..." value={rawInput} onChange={(e) => setRawInput(e.target.value)}></textarea>
                            <div className="flex justify-between items-center mt-2"><button onClick={parseData} className="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-2 rounded-md text-sm font-medium transition-colors flex justify-center items-center gap-2"><Icon path={ICONS.save} size={16} /> Parse Schedule</button></div>
                            {parseError && <div className="mt-3 bg-red-50 rounded border border-red-200 overflow-hidden"><div className="p-2 bg-red-100 text-red-800 text-xs font-bold flex items-center gap-2"><Icon path={ICONS.xCircle} size={14} /> {parseError}</div><div className="max-h-32 overflow-y-auto p-2"><ul className="space-y-1">{failedLines.map((line, idx) => <li key={idx} className="text-[10px] text-red-600 font-mono bg-white border border-red-100 p-1 rounded break-all">{line}</li>)}</ul></div></div>}
                          </div>
                          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 h-[500px] flex flex-col">
                            <div className="flex justify-between items-center mb-3"><h2 className="font-bold text-gray-700 flex items-center gap-2"><Icon path={ICONS.alertCircle} size={18} className="text-orange-500" /> Unassigned</h2><span className="text-xs bg-gray-200 px-2 py-0.5 rounded-full">{unassignedClasses.length}</span></div>
                            {unassignedClasses.length > 0 && <button onClick={autoAssignClasses} className="mb-3 w-full bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white text-xs font-bold py-2 rounded-lg shadow-sm flex items-center justify-center gap-2 transition-all active:scale-95"><Icon path={ICONS.wand2} size={14} /> Magic Auto-Assign</button>}
                            <div className="overflow-y-auto flex-1 space-y-3 pr-1">
                              {unassignedClasses.length === 0 ? <p className="text-xs text-gray-400 text-center mt-10">No unassigned classes.</p> : unassignedClasses.map(cls => (
                                <ClassCard key={cls.id} cls={cls} isEditing={editingClassId === cls.id} editForm={editForm} onEditStart={startEditing} onEditCancel={cancelEditing} onEditSave={saveEditing} onEditChange={handleEditChange} onAssignRoom={assignRoom} onDeleteClass={deleteClass} rooms={rooms} getClassStyle={getClassStyle} />
                              ))}
                            </div>
                          </div>
                        </div>

                        <div className="lg:col-span-6">
                            <div className="flex bg-gray-100 p-1 rounded-lg overflow-x-auto no-scrollbar mb-4">
                              {DAYS.map(day => (
                                <button key={day} onClick={() => setActiveDay(day)} className={`px-3 py-1.5 text-sm font-medium rounded-md transition-all whitespace-nowrap ${activeDay === day ? 'bg-white text-indigo-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>{day}</button>
                              ))}
                            </div>
                            <div style={{ height: '600px' }}>
                                <DayTimetable 
                                    day={activeDay} 
                                    rooms={rooms} 
                                    classes={classes} 
                                    onAssignRoom={assignRoom} 
                                    getClassStyle={getClassStyle} 
                                />
                            </div>
                        </div>

                        <div className="lg:col-span-3 space-y-6">
                          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                            <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-3"><Icon path={ICONS.monitor} size={18} /> Rooms</h2>
                            <div className="flex gap-2 mb-4"><input type="text" placeholder="New Room..." className="flex-1 p-2 text-sm border rounded outline-none focus:border-indigo-500" value={newRoomName} onChange={(e) => setNewRoomName(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addRoom()} /><button onClick={addRoom} className="bg-green-600 text-white p-2 rounded hover:bg-green-700"><Icon path={ICONS.plus} size={18} /></button></div>
                            <div className="space-y-2 max-h-40 overflow-y-auto">{rooms.map(room => (<div key={room} className="flex justify-between items-center text-sm bg-gray-50 p-2 rounded border border-gray-100"><span>{room}</span><button onClick={() => removeRoom(room)} className="text-red-400 hover:text-red-600" title="Delete Room"><Icon path={ICONS.trash2} size={14} /></button></div>))}</div>
                          </div>
                          <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                            <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-4"><Icon path={ICONS.barChart2} size={18} /> Instructor Hours</h2>
                            <div className="overflow-x-auto">
                              <table className="w-full text-sm text-left">
                                <thead className="text-xs text-gray-500 uppercase bg-gray-50"><tr><th className="px-2 py-2">Name</th><th className="px-2 py-2 text-center">Classes</th><th className="px-2 py-2 text-right">Hrs</th></tr></thead>
                                <tbody className="divide-y divide-gray-100">
                                  {instructorStats.length === 0 ? <tr><td colSpan="3" className="p-4 text-center text-gray-400 text-xs">No data parsed yet.</td></tr> : instructorStats.map(([name, data]) => (
                                      <tr key={name} className="hover:bg-gray-50"><td className="px-2 py-2 font-medium text-gray-800 truncate max-w-[100px]" title={name}>{name}</td><td className="px-2 py-2 text-center text-gray-500">{data.count}</td><td className="px-2 py-2 text-right font-bold text-indigo-600">{data.hours.toFixed(1)}</td></tr>
                                  ))}
                                </tbody>
                              </table>
                            </div>
                          </div>
                        </div>
                    </div>
                )}

                {viewMode === 'weekly' && (
                    <div className="space-y-8">
                        {DAYS.map(day => (
                            <div key={day} className="w-full h-[600px]">
                                <DayTimetable 
                                    day={day} 
                                    rooms={rooms} 
                                    classes={classes} 
                                    onAssignRoom={assignRoom} 
                                    getClassStyle={getClassStyle} 
                                    fullWidth={true}
                                />
                            </div>
                        ))}
                    </div>
                )}

              </main>
            </div>
          );
        };

        const container = document.getElementById('root');
        if (container) {
          const root = ReactDOM.createRoot(container);
          root.render(<App />);
        }
    </script>
</body>
</html>
