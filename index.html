<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>School Timetable Manager (Final)</title>
    
    <!-- Favicon (Timetable Grid Style) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234f46e5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='3' width='18' height='18' rx='2' ry='2'></rect><path d='M3 9h18M3 15h18M9 3v18M15 3v18'/></svg>" />

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7cc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #a1a1aa; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-backdrop { animation: fadeIn 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const PRELOADED_DATA = {"version":1764337687962,"rawInput":"V1_Par_ì›”4(E) Aeneas Sparks-Webb\nA2_Eagle_ì›”4(E) Olivia Constable\nV1_Bridge_ì›”4(E) Karen Shelley\nJump up ì›”4(E) Ryan S. Kim\nA2_Albatross_ì›”4(E) Joseph Choi\nA2_Birdie_ì›”4(E) Christopher Ing\nA2_Tera_ì›”4(E) Igor Pak\nV1_Bridge_í™”4(E)_2 Holley Bailey\nA2_Giga_í™”4(E) Aeneas Sparks-Webb\nA2_Tera_í™”4(E) Olivia Constable\nV1_Bridge_í™”4(E)_1 Karen Shelley\nA2_Albatross_í™”4(E) Ryan S. Kim\nA2_Giga_í™”4(E) Lesley Anne Mayo\nV1_Birdie_í™”4(E)_1 Joseph Choi\nA2_Par_í™”4(E)_2 Christopher Ing\nV1_Eagle_í™”4(E) Igor Pak\nV1_Bridge_ìˆ˜4(E) Holley Bailey\nA2_Giga_ìˆ˜4(E) Aeneas Sparks-Webb\nV1_Par_ìˆ˜4(E) Olivia Constable\nF1_EC4_ìˆ˜ê¸ˆ4(E) Karen Shelley\nA2_Giga_ìˆ˜4(E) Lesley Anne Mayo\nV1_Albatross_ìˆ˜4(E) Christopher Ing\nV1_Eagle_ìˆ˜4(E) Igor Pak\nV1_Giga_ëª©4(E) Holley Bailey\nV1_Par_ëª©4(E)_2 Aeneas Sparks-Webb\nV1_Par_ëª©4(E)_1 Olivia Constable\nA2_Birdie_ëª©4(E)_1 Karen Shelley\nA2_Albatross_ëª©4(E) Ryan S. Kim\nV1_Tera_ëª©4(E) Lesley Anne Mayo\nA2_Bridge_ëª©4(E)_2 Joseph Choi\nA2_Eagle_ëª©4(E) Christopher Ing\nA2_Bridge_ëª©4(E)_1 Igor Pak\nV1_Giga_ê¸ˆ4(E) Holley Bailey\nF1_EC4_ìˆ˜ê¸ˆ4(E) Karen Shelley\nA2_Bridge_ê¸ˆ4(E) Ryan S. Kim\nV1_Tera_ê¸ˆ4(E) Lesley Anne Mayo\nV1_Birdie_ê¸ˆ4(E) Joseph Choi\nV1_Mega_ê¸ˆ4(E) Christopher Ing\nA2_Par_ê¸ˆ4(E)_1 Igor Pak\nV1_Albatross_ì›”7(M) Holley Bailey\nV1_Albatross+_ì›”7(M) Karen Shelley\nGL101_ì›”7(M) Lesley Anne Mayo\nV1_Albatross_í™”7(M) Holley Bailey\nA2_tera_í™”7(M) Aeneas Sparks-Webb\nD101B_í™”7(M) Olivia Constable\nD302_í™”7(M)_G Ryan S. Kim\nA2_Eagle_í™”7(M) Christopher Ing\nV1_Albatross+_í™”7(M) Igor Pak\nA2_Par_ëª©7(M) Holley Bailey\nA2_Bridge_ëª©7(M) Aeneas Sparks-Webb\nA2_Albatross+_ëª©7(M)_1 Olivia Constable\nA2_Birdie_ëª©7(M) Karen Shelley\nIM202_ëª©7(M) Ryan S. Kim\nGL101_ëª©7(M) Lesley Anne Mayo\nD103_ëª©7(M) Joseph Choi\nA2_Albatross_ëª©7(M) Igor Pak\nA2_Eagle_ê¸ˆ7(M) Aeneas Sparks-Webb\nD101B_ê¸ˆ7(M) Olivia Constable\nA2_Albatross+_ê¸ˆ7(M) Lesley Anne Mayo\nA2_Albatross_ê¸ˆ7(M) Christopher Ing","classes":[{"id":"cls-1764337662218-0","raw":"V1_Par_ì›”4(E) Aeneas Sparks-Webb","type":"V1","level":"Par","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662218-1","raw":"A2_Eagle_ì›”4(E) Olivia Constable","type":"A2","level":"Eagle","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662218-2","raw":"V1_Bridge_ì›”4(E) Karen Shelley","type":"V1","level":"Bridge","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Karen Shelley","duration":3,"roomId":"406"},{"id":"cls-1764337662218-4","raw":"A2_Albatross_ì›”4(E) Joseph Choi","type":"A2","level":"Albatross","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Joseph Choi","duration":3,"roomId":"602"},{"id":"cls-1764337662218-5","raw":"A2_Birdie_ì›”4(E) Christopher Ing","type":"A2","level":"Birdie","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662218-6","raw":"A2_Tera_ì›”4(E) Igor Pak","type":"A2","level":"Tera","day":"ì›”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662218-7","raw":"V1_Bridge_í™”4(E)_2 Holley Bailey","type":"V1","level":"Bridge","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662218-8","raw":"A2_Giga_í™”4(E) Aeneas Sparks-Webb","type":"A2","level":"Giga","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662218-9","raw":"A2_Tera_í™”4(E) Olivia Constable","type":"A2","level":"Tera","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662218-10","raw":"V1_Bridge_í™”4(E)_1 Karen Shelley","type":"V1","level":"Bridge","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Karen Shelley","duration":3,"roomId":"406"},{"id":"cls-1764337662218-11","raw":"A2_Albatross_í™”4(E) Ryan S. Kim","type":"A2","level":"Albatross","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Ryan S. Kim","duration":3,"roomId":"407"},{"id":"cls-1764337662218-12","raw":"A2_Giga_í™”4(E) Lesley Anne Mayo","type":"A2","level":"Giga","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662218-13","raw":"V1_Birdie_í™”4(E)_1 Joseph Choi","type":"V1","level":"Birdie","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Joseph Choi","duration":3,"roomId":"602"},{"id":"cls-1764337662218-14","raw":"A2_Par_í™”4(E)_2 Christopher Ing","type":"A2","level":"Par","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662218-15","raw":"V1_Eagle_í™”4(E) Igor Pak","type":"V1","level":"Eagle","day":"í™”","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662218-16","raw":"V1_Bridge_ìˆ˜4(E) Holley Bailey","type":"V1","level":"Bridge","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662218-17","raw":"A2_Giga_ìˆ˜4(E) Aeneas Sparks-Webb","type":"A2","level":"Giga","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662218-18","raw":"V1_Par_ìˆ˜4(E) Olivia Constable","type":"V1","level":"Par","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662218-20","raw":"A2_Giga_ìˆ˜4(E) Lesley Anne Mayo","type":"A2","level":"Giga","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662218-21","raw":"V1_Albatross_ìˆ˜4(E) Christopher Ing","type":"V1","level":"Albatross","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662218-22","raw":"V1_Eagle_ìˆ˜4(E) Igor Pak","type":"V1","level":"Eagle","day":"ìˆ˜","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662218-23","raw":"V1_Giga_ëª©4(E) Holley Bailey","type":"V1","level":"Giga","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662218-24","raw":"V1_Par_ëª©4(E)_2 Aeneas Sparks-Webb","type":"V1","level":"Par","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662218-25","raw":"V1_Par_ëª©4(E)_1 Olivia Constable","type":"V1","level":"Par","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662218-26","raw":"A2_Birdie_ëª©4(E)_1 Karen Shelley","type":"A2","level":"Birdie","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Karen Shelley","duration":3,"roomId":"406"},{"id":"cls-1764337662218-27","raw":"A2_Albatross_ëª©4(E) Ryan S. Kim","type":"A2","level":"Albatross","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Ryan S. Kim","duration":3,"roomId":"407"},{"id":"cls-1764337662218-28","raw":"V1_Tera_ëª©4(E) Lesley Anne Mayo","type":"V1","level":"Tera","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662218-29","raw":"A2_Bridge_ëª©4(E)_2 Joseph Choi","type":"A2","level":"Bridge","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Joseph Choi","duration":3,"roomId":"602"},{"id":"cls-1764337662218-30","raw":"A2_Eagle_ëª©4(E) Christopher Ing","type":"A2","level":"Eagle","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662218-31","raw":"A2_Bridge_ëª©4(E)_1 Igor Pak","type":"A2","level":"Bridge","day":"ëª©","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662218-32","raw":"V1_Giga_ê¸ˆ4(E) Holley Bailey","type":"V1","level":"Giga","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662219-34","raw":"A2_Bridge_ê¸ˆ4(E) Ryan S. Kim","type":"A2","level":"Bridge","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Ryan S. Kim","duration":3,"roomId":"407"},{"id":"cls-1764337662219-35","raw":"V1_Tera_ê¸ˆ4(E) Lesley Anne Mayo","type":"V1","level":"Tera","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662219-36","raw":"V1_Birdie_ê¸ˆ4(E) Joseph Choi","type":"V1","level":"Birdie","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Joseph Choi","duration":3,"roomId":"602"},{"id":"cls-1764337662219-37","raw":"V1_Mega_ê¸ˆ4(E) Christopher Ing","type":"V1","level":"Mega","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662219-38","raw":"A2_Par_ê¸ˆ4(E)_1 Igor Pak","type":"A2","level":"Par","day":"ê¸ˆ","period":"4","studentType":"E","startTime":"16:00","endTime":"19:00","startMin":960,"endMin":1140,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662219-39","raw":"V1_Albatross_ì›”7(M) Holley Bailey","type":"V1","level":"Albatross","day":"ì›”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662219-40","raw":"V1_Albatross+_ì›”7(M) Karen Shelley","type":"V1","level":"Albatross+","day":"ì›”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Karen Shelley","duration":3,"roomId":"406"},{"id":"cls-1764337662219-41","raw":"GL101_ì›”7(M) Lesley Anne Mayo","type":"GL101","level":"GL101","day":"ì›”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662219-42","raw":"V1_Albatross_í™”7(M) Holley Bailey","type":"V1","level":"Albatross","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662219-43","raw":"A2_tera_í™”7(M) Aeneas Sparks-Webb","type":"A2","level":"tera","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662219-44","raw":"D101B_í™”7(M) Olivia Constable","type":"D101B","level":"D101B","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662219-45","raw":"D302_í™”7(M)_G Ryan S. Kim","type":"D302","level":"D302","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"G Ryan S. Kim","duration":3,"roomId":"407"},{"id":"cls-1764337662219-46","raw":"A2_Eagle_í™”7(M) Christopher Ing","type":"A2","level":"Eagle","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"},{"id":"cls-1764337662219-47","raw":"V1_Albatross+_í™”7(M) Igor Pak","type":"V1","level":"Albatross+","day":"í™”","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662219-48","raw":"A2_Par_ëª©7(M) Holley Bailey","type":"A2","level":"Par","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Holley Bailey","duration":3,"roomId":"401"},{"id":"cls-1764337662219-49","raw":"A2_Bridge_ëª©7(M) Aeneas Sparks-Webb","type":"A2","level":"Bridge","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662219-50","raw":"A2_Albatross+_ëª©7(M)_1 Olivia Constable","type":"A2","level":"Albatross+","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662219-51","raw":"A2_Birdie_ëª©7(M) Karen Shelley","type":"A2","level":"Birdie","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Karen Shelley","duration":3,"roomId":"406"},{"id":"cls-1764337662219-52","raw":"IM202_ëª©7(M) Ryan S. Kim","type":"IM202","level":"IM202","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Ryan S. Kim","duration":3,"roomId":"407"},{"id":"cls-1764337662219-53","raw":"GL101_ëª©7(M) Lesley Anne Mayo","type":"GL101","level":"GL101","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662219-54","raw":"D103_ëª©7(M) Joseph Choi","type":"D103","level":"D103","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Joseph Choi","duration":3,"roomId":"602"},{"id":"cls-1764337662219-55","raw":"A2_Albatross_ëª©7(M) Igor Pak","type":"A2","level":"Albatross","day":"ëª©","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Igor Pak","duration":3,"roomId":"606"},{"id":"cls-1764337662219-56","raw":"A2_Eagle_ê¸ˆ7(M) Aeneas Sparks-Webb","type":"A2","level":"Eagle","day":"ê¸ˆ","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Aeneas Sparks-Webb","duration":3,"roomId":"404"},{"id":"cls-1764337662219-57","raw":"D101B_ê¸ˆ7(M) Olivia Constable","type":"D101B","level":"D101B","day":"ê¸ˆ","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Olivia Constable","duration":3,"roomId":"405"},{"id":"cls-1764337662219-58","raw":"A2_Albatross+_ê¸ˆ7(M) Lesley Anne Mayo","type":"A2","level":"Albatross+","day":"ê¸ˆ","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Lesley Anne Mayo","duration":3,"roomId":"601"},{"id":"cls-1764337662219-59","raw":"A2_Albatross_ê¸ˆ7(M) Christopher Ing","type":"A2","level":"Albatross","day":"ê¸ˆ","period":"7","studentType":"M","startTime":"19:00","endTime":"22:00","startMin":1140,"endMin":1320,"count":"0","instructor":"Christopher Ing","duration":3,"roomId":"603"}],"rooms":["401","402","403","404","405","406","407","601","602","603","605","606","607"],"instructorPrefs":{"Aeneas Sparks-Webb":"404","Christopher Ing":"603","G Ryan S. Kim":"407","Holley Bailey":"401","Igor Pak":"606","Joseph Choi":"602","Karen Shelley":"406","Lesley Anne Mayo":"601","Olivia Constable":"405","Ryan S. Kim":"407"},"instructorDurations":{"Aeneas Sparks-Webb":3,"Christopher Ing":3,"G Ryan S. Kim":3,"Holley Bailey":3,"Igor Pak":3,"Joseph Choi":3,"Karen Shelley":3,"Lesley Anne Mayo":3,"Olivia Constable":3,"Ryan S. Kim":3}}; 

        const { useState, useEffect, useMemo, useCallback } = React;
        
        const START_HOUR = 13; 
        const END_HOUR = 22;   

        const Icon = ({ path, size = 18, className = "" }) => (
          <svg className={`w-${size/4} h-${size/4} ${className}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width={size} height={size}>
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d={path} />
          </svg>
        );

        const STORAGE_KEYS = {
            RAW_INPUT: 'stm_raw_input',
            CLASSES: 'stm_classes',
            ROOMS: 'stm_rooms',
            PREFS: 'stm_instructor_prefs',
            DURATIONS: 'stm_instructor_durations',
            LICENSE_AGREED: 'stm_license_agreed',
            VERSION: 'stm_version' 
        };

        const ICONS = {
            calendar: "M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z",
            clock: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
            users: "M17 20h2a2 2 0 002-2v-2a2 2 0 00-2-2H9a2 2 0 00-2 2v2a2 2 0 002 2h2m-4-6a4 4 0 11-8 0 4 4 0 018 0zM12 14c-1.105 0-2-.895-2-2v-1h4v1c0 1.105-.895 2-2 2z",
            bookOpen: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 4 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 3.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",
            trash2: "M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16",
            plus: "M12 4v16m8-8H4",
            save: "M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4",
            barChart2: "M18 20V10M12 20V4M6 20v-6",
            monitor: "M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z",
            alertCircle: "M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
            xCircle: "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
            edit2: "M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-11-2l2 2m-2-2l-2 2m4 4l-4 4m2 0l2 2m-2-2l2 2m-4 4l2-2m-2 2l-2-2m4 4l-2 2",
            x: "M6 18L18 6M6 6l12 12",
            check: "M5 13l4 4L19 7",
            palette: "M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01",
            wand2: "M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z",
            settings: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z M15 12a3 3 0 11-6 0 3 3 0 016 0z",
            table: "M3 10h18M3 14h18m-9-4v8m-7.5-8v8m15-8v8M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V6z",
            download: "M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4",
            layout: "M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z",
            code: "M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4",
            fileText: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z M14 2v6h6 M16 13H8 M16 17H8 M10 9H8",
            lock: "M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z",
            externalLink: "M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6m4-3h6v6m-11 5L21 3",
            refresh: "M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
        };

        const PASTEL_PALETTE = [
            '#FFD1DC', '#FFDFD3', '#FFFFD1', '#E2F0CB', '#B5EAD7', '#C7CEEA', 
            '#F0E68C', '#E6E6FA', '#FFB6C1', '#ADD8E6', '#90EE90', '#FFDEAD', 
            '#D8BFD8', '#FFEFD5', '#FFE4E1', '#E0FFFF', '#FAFAD2', '#D3D3D3' 
        ];

        const DAYS = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
        const DAY_MAP = {
            'ì›”': 'Monday', 'í™”': 'Tuesday', 'ìˆ˜': 'Wednesday', 'ëª©': 'Thursday', 
            'ê¸ˆ': 'Friday', 'í† ': 'Saturday', 'ì¼': 'Sunday'
          };

        // --- License Modal ---
        const LicenseModal = ({ onAgree }) => {
            const [checked, setChecked] = useState(false);
            const [showDetail, setShowDetail] = useState(false);

            return (
                <div className="fixed inset-0 z-[9999] flex items-center justify-center modal-backdrop">
                    <div className="absolute inset-0 bg-gray-900 bg-opacity-90 backdrop-blur-md"></div>
                    <div className="bg-white p-8 rounded-2xl shadow-2xl z-10 max-w-lg w-full mx-4 border border-gray-200 relative">
                        <div className="text-center mb-6">
                            <div className="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4"><Icon path={ICONS.bookOpen} size={32} /></div>
                            <h1 className="text-2xl font-bold text-gray-800 mb-2">School Timetable Manager</h1>
                            <p className="text-sm text-gray-500">ì˜¤í”ˆ ì†ŒìŠ¤ ì‹œê°„í‘œ ê´€ë¦¬ í”„ë¡œê·¸ë¨</p>
                        </div>
                        <div className="bg-gray-50 p-4 rounded-xl border border-gray-200 mb-6 text-sm text-gray-600 leading-relaxed">
                            <h3 className="font-bold text-gray-800 mb-2 flex items-center gap-2">
                                <Icon path={ICONS.lock} size={16} /> ë¼ì´ì„ ìŠ¤ ìš”ì•½ (CC BY-NC-ND 4.0)
                            </h3>
                            <ul className="list-disc pl-5 space-y-1 mb-3 text-xs">
                                <li><strong>ì €ì‘ì í‘œì‹œ:</strong> ì›ì‘ìë¥¼ í‘œì‹œí•´ì•¼ í•©ë‹ˆë‹¤.</li>
                                <li><strong>ë¹„ì˜ë¦¬:</strong> ì˜ë¦¬ ëª©ì ìœ¼ë¡œ ì´ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>
                                <li><strong>ë³€ê²½ ê¸ˆì§€:</strong> ë¦¬ë¯¹ìŠ¤, ë³€í˜•, 2ì°¨ì  ì €ì‘ë¬¼ ì‘ì„± ë¶ˆê°€.</li>
                            </ul>
                            <div className="flex gap-2 mt-3 border-t border-gray-200 pt-3">
                                <button onClick={() => setShowDetail(!showDetail)} className="flex-1 text-xs bg-white border border-gray-300 hover:bg-gray-100 px-3 py-1.5 rounded text-gray-700 font-medium transition-colors">
                                    {showDetail ? "â–² ê°„ëµíˆ" : "â–¼ ë¼ì´ì„ ìŠ¤ ì „ë¬¸ í¼ì³ë³´ê¸°"}
                                </button>
                                <a href="https://github.com/devinweston36-star/School-Timetable-Manager/blob/main/LICENSE.md" target="_blank" rel="noopener noreferrer" className="flex-1 flex items-center justify-center gap-1 text-xs bg-gray-800 hover:bg-gray-900 text-white px-3 py-1.5 rounded font-medium transition-colors">
                                    <span>GitHubì—ì„œ ë³´ê¸°</span><Icon path={ICONS.externalLink} size={10} />
                                </a>
                            </div>
                            {showDetail && (
                                <div className="mt-3 p-3 bg-white border border-gray-200 rounded text-[10px] h-40 overflow-y-auto leading-relaxed text-gray-500 font-mono">
                                    <strong>Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International</strong><br/><br/>
                                    By exercising the Licensed Rights (defined below), You accept and agree to be bound by the terms and conditions of this Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International Public License ("Public License")...<br/><br/>
                                    (ì´í•˜ ìƒëµ... ì „ì²´ ë‚´ìš©ì€ GitHub ë§í¬ë¥¼ í™•ì¸í•˜ì„¸ìš”)<br/><br/>
                                    ë³¸ í”„ë¡œê·¸ë¨ì€ ì‚¬ìš©ìì˜ í¸ì˜ë¥¼ ìœ„í•´ ì œê³µë˜ë©°, ì–´ë– í•œ í˜•íƒœì˜ ë³´ì¦ë„ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
                                </div>
                            )}
                        </div>
                        <div className="flex flex-col gap-4">
                            <label className="flex items-center gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                <input type="checkbox" className="w-5 h-5 text-indigo-600 rounded focus:ring-indigo-500" checked={checked} onChange={(e) => setChecked(e.target.checked)} />
                                <span className="text-sm font-medium text-gray-700">ìœ„ ë¼ì´ì„ ìŠ¤ ë‚´ìš©ì„ í™•ì¸í•˜ì˜€ìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤.</span>
                            </label>
                            <button onClick={onAgree} disabled={!checked} className={`w-full py-3 rounded-lg font-bold text-white transition-all shadow-md flex items-center justify-center gap-2 ${checked ? 'bg-indigo-600 hover:bg-indigo-700 hover:shadow-lg transform hover:-translate-y-0.5' : 'bg-gray-300 cursor-not-allowed'}`}>ì‹œì‘í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Add Class Modal ---
        const AddClassModal = ({ onClose, onAdd, rooms }) => {
            const [form, setForm] = useState({ type: 'General', level: '', instructor: '', day: 'ì›”', startTime: '14:00', endTime: '16:00', count: 0, studentType: 'All', roomId: '' });
            const handleChange = (field, value) => setForm(prev => ({ ...prev, [field]: value }));
            const handleSubmit = () => {
                if(!form.level || !form.instructor) return alert("ê°•ì˜ëª…(Level)ê³¼ ê°•ì‚¬ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
                onAdd(form); onClose();
            };
            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                    <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={onClose}></div>
                    <div className="bg-white w-full max-w-md rounded-xl shadow-2xl z-10 overflow-hidden">
                        <div className="p-4 bg-indigo-50 border-b border-indigo-100 flex justify-between items-center">
                            <h3 className="font-bold text-indigo-800 flex items-center gap-2"><Icon path={ICONS.plus} size={18} /> New Lecture</h3>
                            <button onClick={onClose} className="text-indigo-400 hover:text-indigo-600"><Icon path={ICONS.x} size={20} /></button>
                        </div>
                        <div className="p-6 space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-gray-500 mb-1">Type</label><input className="w-full p-2 border rounded text-sm" value={form.type} onChange={e => handleChange('type', e.target.value)} /></div>
                                <div><label className="block text-xs font-bold text-gray-500 mb-1">Student Type</label><input className="w-full p-2 border rounded text-sm" value={form.studentType} onChange={e => handleChange('studentType', e.target.value)} /></div>
                            </div>
                            <div><label className="block text-xs font-bold text-gray-500 mb-1">Level (Class Name)</label><input className="w-full p-2 border rounded text-sm" placeholder="e.g. Calculus 101" value={form.level} onChange={e => handleChange('level', e.target.value)} /></div>
                            <div><label className="block text-xs font-bold text-gray-500 mb-1">Instructor</label><input className="w-full p-2 border rounded text-sm" placeholder="Instructor Name" value={form.instructor} onChange={e => handleChange('instructor', e.target.value)} /></div>
                             <div className="grid grid-cols-3 gap-4">
                                <div><label className="block text-xs font-bold text-gray-500 mb-1">Day</label><select className="w-full p-2 border rounded text-sm" value={form.day} onChange={e => handleChange('day', e.target.value)}>{DAYS.map(d => <option key={d} value={d}>{d}</option>)}</select></div>
                                <div className="col-span-2 grid grid-cols-2 gap-2">
                                    <div><label className="block text-xs font-bold text-gray-500 mb-1">Start</label><input type="time" className="w-full p-2 border rounded text-sm" value={form.startTime} onChange={e => handleChange('startTime', e.target.value)} /></div>
                                    <div><label className="block text-xs font-bold text-gray-500 mb-1">End</label><input type="time" className="w-full p-2 border rounded text-sm" value={form.endTime} onChange={e => handleChange('endTime', e.target.value)} /></div>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="block text-xs font-bold text-gray-500 mb-1">Students</label><input type="number" className="w-full p-2 border rounded text-sm" value={form.count} onChange={e => handleChange('count', e.target.value)} /></div>
                                <div><label className="block text-xs font-bold text-gray-500 mb-1">Room (Optional)</label><select className="w-full p-2 border rounded text-sm" value={form.roomId} onChange={e => handleChange('roomId', e.target.value)}><option value="">-- Unassigned --</option>{rooms.map(r => <option key={r} value={r}>{r}</option>)}</select></div>
                            </div>
                            <button onClick={handleSubmit} className="w-full py-2 bg-indigo-600 text-white rounded-lg font-bold hover:bg-indigo-700 transition-colors shadow-md mt-2">Add Class</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- DayTimetable Component ---
        const DayTimetable = React.memo(({ day, rooms, classes, onAssignRoom, getClassStyle, fullWidth = false, readOnly = false, onExportExcel, colorScheme, setColorScheme }) => {
            const dayClasses = classes.filter(c => c.day === day && c.roomId);
            const totalMinutes = (END_HOUR - START_HOUR) * 60;
            
            return (
                <div className={`bg-white rounded-xl shadow-sm border flex flex-col overflow-hidden h-full ${readOnly ? 'border-indigo-100' : 'border-gray-200'}`}>
                    <div className={`p-3 border-b font-bold flex justify-between items-center ${readOnly ? 'bg-indigo-50 border-indigo-100 text-indigo-800' : 'bg-gray-50 border-gray-100 text-gray-700'}`}>
                        <div className="flex items-center gap-4">
                            <span>{DAY_MAP[day]} ({day})</span>
                            <div className="flex items-center gap-2 bg-white/50 border border-gray-200/50 rounded-lg p-0.5 px-2">
                                <Icon path={ICONS.palette} size={12} className="text-gray-400" />
                                <select value={colorScheme} onChange={(e) => setColorScheme(e.target.value)} className="bg-transparent text-gray-600 border-none rounded text-[10px] p-0 focus:ring-0 cursor-pointer outline-none" title="Change Color Scheme">
                                    <option value="type">Color: Type</option><option value="instructor">Color: Teacher</option><option value="level">Color: Level</option>
                                </select>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            {fullWidth && <span className="text-xs opacity-60 font-normal mr-2">{START_HOUR}:00 - {END_HOUR}:00</span>}
                            {!fullWidth && <button onClick={() => onExportExcel(day)} className="flex items-center gap-1 px-2 py-1 bg-green-50 text-green-700 hover:bg-green-100 border border-green-200 rounded text-xs transition-colors" title="Copy Excel"><Icon path={ICONS.download} size={12} /><span className="hidden sm:inline">Copy Daily Excel</span></button>}
                        </div>
                    </div>
                    <div className="flex-1 overflow-x-auto overflow-y-auto p-2 relative">
                        <div className="min-w-[600px]" style={{ minWidth: fullWidth ? '100%' : '600px' }}>
                            <div className="flex border-b-2 border-gray-200 pb-2 mb-2 sticky top-0 bg-white z-10">
                                <div className="w-12 flex-shrink-0"></div>{rooms.map(room => <div key={room} className="flex-1 text-center font-bold text-gray-700 text-sm truncate px-1">{room}</div>)}
                            </div>
                            <div className="relative" style={{ height: '500px' }}>
                                {Array.from({ length: (END_HOUR - START_HOUR) + 1 }).map((_, i) => {
                                    const hour = START_HOUR + i; const topPct = (i / (END_HOUR - START_HOUR)) * 100;
                                    return (<div key={i} className="absolute w-full flex items-center pointer-events-none" style={{ top: `${topPct}%` }}><div className="w-12 text-xs text-gray-400 text-right pr-2 -mt-2">{hour}:00</div><div className="flex-1 h-px bg-gray-100"></div></div>);
                                })}
                                <div className="absolute top-0 left-12 right-0 bottom-0 flex">
                                    {rooms.map(room => {
                                        const roomClasses = dayClasses.filter(c => c.roomId === room);
                                        return (<div key={room} className="flex-1 relative border-l border-gray-50 h-full mx-1">{roomClasses.map(cls => {
                                            const startOffset = cls.startMin - (START_HOUR * 60); if (startOffset < 0) return null;
                                            const topPct = (startOffset / totalMinutes) * 100; const heightPct = ((cls.duration * 60) / totalMinutes) * 100; const style = getClassStyle(cls);
                                            return (<div key={cls.id} className={`absolute w-full px-1 rounded shadow-sm overflow-hidden text-[10px] hover:z-20 hover:scale-105 transition-transform cursor-pointer border-l-2 flex flex-col justify-center group ${readOnly ? 'opacity-90' : ''}`} style={{ top: `${topPct}%`, height: `${heightPct}%`, maxHeight: `${heightPct}%`, backgroundColor: style.backgroundColor, borderLeftColor: style.borderColor, color: style.color }} title={`${cls.level} by ${cls.instructor}`} onClick={() => !readOnly && onAssignRoom(cls.id, null)}><div className="font-bold truncate">{cls.level}</div><div className="truncate opacity-75">{cls.instructor}</div><div className="truncate text-[9px] hidden sm:block">{cls.startTime}-{cls.endTime}</div></div>);
                                        })}</div>);
                                    })}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        });

        // --- ClassCard Component ---
        const ClassCard = React.memo(({ cls, compact = false, isEditing, editForm, onEditStart, onEditCancel, onEditSave, onEditChange, onAssignRoom, onDeleteClass, rooms, getClassStyle, readOnly = false }) => {
            const style = getClassStyle(cls);
            if (isEditing && !readOnly) {
              return (
                <div className="p-3 rounded-lg border-2 border-indigo-500 bg-white shadow-lg text-sm space-y-2">
                  <div className="flex justify-between items-center mb-1"><span className="text-xs font-bold text-indigo-600">Editing</span><div className="flex gap-1"><button onClick={onEditSave} className="p-1 bg-green-100 text-green-700 rounded hover:bg-green-200"><Icon path={ICONS.check} size={14}/></button><button onClick={onEditCancel} className="p-1 bg-red-100 text-red-700 rounded hover:bg-red-200"><Icon path={ICONS.x} size={14}/></button></div></div>
                  <div><label className="block text-[10px] font-bold text-gray-500">Level</label><input className="w-full p-1 border rounded text-xs" value={editForm.level || ''} onChange={e => onEditChange('level', e.target.value)} /></div>
                  <div className="grid grid-cols-2 gap-2"><div><label className="block text-[10px] font-bold text-gray-500">Instructor</label><input className="w-full p-1 border rounded text-xs" value={editForm.instructor || ''} onChange={e => onEditChange('instructor', e.target.value)} /></div><div><label className="block text-[10px] font-bold text-gray-500">Students</label><input className="w-full p-1 border rounded text-xs" type="number" value={editForm.count || 0} onChange={e => onEditChange('count', e.target.value)} /></div></div>
                  <div className="grid grid-cols-3 gap-1"><div><label className="block text-[10px] font-bold text-gray-500">Day</label><select className="w-full p-1 border rounded text-xs" value={editForm.day} onChange={e => onEditChange('day', e.target.value)}>{DAYS.map(d => <option key={d} value={d}>{d}</option>)}</select></div><div className="col-span-2 grid grid-cols-2 gap-1"><input type="time" className="w-full p-1 border rounded text-xs" value={editForm.startTime} onChange={e => onEditChange('startTime', e.target.value)} /><input type="time" className="w-full p-1 border rounded text-xs" value={editForm.endTime} onChange={e => onEditChange('endTime', e.target.value)} /></div></div>
                </div>
              );
            }
            return (
              <div className={`p-3 rounded-lg border-l-4 shadow-sm text-sm transition-all hover:shadow-md relative group bg-white ${readOnly ? 'opacity-80' : ''}`} style={{ backgroundColor: style.backgroundColor, borderLeftColor: style.borderColor, color: style.color }}>
                {!readOnly && (<><button onClick={(e) => { e.stopPropagation(); onEditStart(cls); }} className="absolute top-2 right-8 p-1 rounded bg-white/50 hover:bg-white text-gray-600 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm" title="Edit"><Icon path={ICONS.edit2} size={12} /></button><button onClick={(e) => { e.stopPropagation(); onDeleteClass(cls.id); }} className="absolute top-2 right-2 p-1 rounded bg-white/50 hover:bg-red-50 text-red-500 opacity-0 group-hover:opacity-100 transition-opacity shadow-sm" title="Delete"><Icon path={ICONS.trash2} size={12} /></button></>)}
                <div className="flex justify-between items-start mb-1 pr-10"><div className="flex items-center gap-2 flex-wrap"><span className="font-bold">{cls.level}</span><span className="px-1.5 py-0.5 rounded text-xs font-bold bg-white/60 border border-black/10 shadow-sm">{cls.day}</span></div><span className="text-xs bg-white/60 px-1 rounded border border-black/10">{cls.studentType}</span></div>
                <div className="flex items-center gap-2 text-xs opacity-90 mb-1"><Icon path={ICONS.clock} size={12} />{cls.startTime} - {cls.endTime}</div>
                <div className="flex justify-between items-center text-xs"><span className="font-medium flex items-center gap-1"><Icon path={ICONS.users} size={12} /> {cls.instructor}</span><span className="bg-white/60 px-1.5 rounded-full text-[10px] border border-black/10">{cls.count} stds</span></div>
                {!compact && !readOnly && (<div className="mt-3 pt-2 border-t border-black/10"><label className="block text-xs font-semibold opacity-70 mb-1">Assign Room:</label><select className="w-full p-1 text-xs border rounded bg-white/80 focus:ring-2 focus:ring-indigo-400 outline-none text-gray-800" value={cls.roomId || ""} onChange={(e) => onAssignRoom(cls.id, e.target.value || null)}><option value="">-- Unassigned --</option>{rooms.map(r => <option key={r} value={r}>{r}</option>)}</select></div>)}
              </div>
            );
        });

        // --- Main App Component ---
        const App = () => {
          const [viewMode, setViewMode] = useState('dashboard'); 
          const [viewSource, setViewSource] = useState('distributed'); 
          // ALWAYS FALSE -> Always Show Modal on Reload
          const [licenseAgreed, setLicenseAgreed] = useState(false); 

          const formatTime = (ts) => ts ? new Date(parseInt(ts)).toLocaleString('ko-KR', { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' }) : 'ì—†ìŒ';
          const loadLocalData = (key, defaultVal) => { const saved = localStorage.getItem(key); return saved ? JSON.parse(saved) : defaultVal; };

          // States
          const [rawInput, setRawInput] = useState(() => { const saved = localStorage.getItem(STORAGE_KEYS.RAW_INPUT); return saved || "CDI_ë‚´ì‹ (ë™ì•„ìœ¤1)_ì›”5(M) (17:00~19:00) [6ëª…] Nahyun Kang\nC2D_Albatross_ì›”7(M) (19:00~22:00) [3ëª…] Olivia Constable\nCDI_Birdie_í™”5(E) (16:00~18:30) [8ëª…] John Doe\nTO_Originator_í™”7(M)_1 (19:00~22:00) [4ëª…] Jane Smith"; });
          const [classes, setClasses] = useState(() => loadLocalData(STORAGE_KEYS.CLASSES, []));
          const [rooms, setRooms] = useState(() => loadLocalData(STORAGE_KEYS.ROOMS, ['401', '402', '403', '404', '405', '406', '407', '601', '602', '603', '605', '606', '607']));
          const [instructorPrefs, setInstructorPrefs] = useState(() => loadLocalData(STORAGE_KEYS.PREFS, {}));
          const [instructorDurations, setInstructorDurations] = useState(() => loadLocalData(STORAGE_KEYS.DURATIONS, {})); 
          const distVersion = PRELOADED_DATA ? PRELOADED_DATA.version : null;

          const [newRoomName, setNewRoomName] = useState('');
          const [activeDay, setActiveDay] = useState('ì›”');
          const [parseError, setParseError] = useState(null);
          const [failedLines, setFailedLines] = useState([]);
          const [editingClassId, setEditingClassId] = useState(null);
          const [editForm, setEditForm] = useState({});
          const [colorScheme, setColorScheme] = useState('type'); 
          const [showPrefModal, setShowPrefModal] = useState(false);
          const [showClearModal, setShowClearModal] = useState(false);
          const [showImportExportModal, setShowImportExportModal] = useState(false);
          const [showAddClassModal, setShowAddClassModal] = useState(false); 
          const [spreadsheetInput, setSpreadsheetInput] = useState('');
          const [toast, setToast] = useState({ show: false, message: '' });

          // Effects
          useEffect(() => {
              if (viewSource === 'personal') {
                  setRawInput(localStorage.getItem(STORAGE_KEYS.RAW_INPUT) || "");
                  setClasses(loadLocalData(STORAGE_KEYS.CLASSES, []));
                  setRooms(loadLocalData(STORAGE_KEYS.ROOMS, ['401', '402', '403', '404', '405', '406', '407', '601', '602', '603', '605', '606', '607']));
                  setInstructorPrefs(loadLocalData(STORAGE_KEYS.PREFS, {}));
                  setInstructorDurations(loadLocalData(STORAGE_KEYS.DURATIONS, {}));
                  showToast("ğŸ“‚ Personal Mode Activated");
              } else {
                  if (PRELOADED_DATA) {
                      setRawInput(PRELOADED_DATA.rawInput || "");
                      setClasses(PRELOADED_DATA.classes || []);
                      setRooms(PRELOADED_DATA.rooms || []);
                      setInstructorPrefs(PRELOADED_DATA.instructorPrefs || {});
                      setInstructorDurations(PRELOADED_DATA.instructorDurations || {}); 
                      showToast("ğŸ”’ Distributed (Read-Only) Mode");
                  } else {
                      alert("No distributed data found.");
                      setViewSource('personal');
                  }
              }
          }, [viewSource]);

          useEffect(() => {
              if (viewSource === 'personal') {
                  localStorage.setItem(STORAGE_KEYS.RAW_INPUT, rawInput);
                  localStorage.setItem(STORAGE_KEYS.CLASSES, JSON.stringify(classes));
                  localStorage.setItem(STORAGE_KEYS.ROOMS, JSON.stringify(rooms));
                  localStorage.setItem(STORAGE_KEYS.PREFS, JSON.stringify(instructorPrefs));
                  localStorage.setItem(STORAGE_KEYS.DURATIONS, JSON.stringify(instructorDurations));
                  localStorage.setItem(STORAGE_KEYS.VERSION, Date.now().toString());
              }
          }, [rawInput, classes, rooms, instructorPrefs, instructorDurations, viewSource]);
          
          useEffect(() => {
            const saveInterval = setInterval(() => { if (viewSource === 'personal') showToast("ğŸ“ Auto-saved to Local Storage"); }, 60000);
            return () => clearInterval(saveInterval);
          }, [viewSource]);

          const showToast = (msg) => { setToast({ show: true, message: msg }); setTimeout(() => setToast({ show: false, message: '' }), 3000); };
          const confirmReset = () => { localStorage.clear(); window.location.reload(); };
          const resetToDistributed = () => {
              if (!PRELOADED_DATA) return alert("No data to reset.");
              if (confirm("âš ï¸ Warning: This will overwrite your personal data with the distributed version.")) {
                  localStorage.setItem(STORAGE_KEYS.RAW_INPUT, PRELOADED_DATA.rawInput);
                  localStorage.setItem(STORAGE_KEYS.CLASSES, JSON.stringify(PRELOADED_DATA.classes));
                  localStorage.setItem(STORAGE_KEYS.ROOMS, JSON.stringify(PRELOADED_DATA.rooms));
                  localStorage.setItem(STORAGE_KEYS.PREFS, JSON.stringify(PRELOADED_DATA.instructorPrefs));
                  localStorage.setItem(STORAGE_KEYS.DURATIONS, JSON.stringify(PRELOADED_DATA.instructorDurations || {}));
                  localStorage.setItem(STORAGE_KEYS.VERSION, Date.now().toString());
                  window.location.reload();
              }
          };

          const handleAddManualClass = (form) => {
              const sParts = form.startTime.split(':').map(Number); const eParts = form.endTime.split(':').map(Number);
              const sMin = sParts[0] * 60 + sParts[1]; const eMin = eParts[0] * 60 + eParts[1];
              const newClass = { id: `cls-man-${Date.now()}`, raw: "Manual", type: form.type, level: form.level, day: form.day, period: "", studentType: form.studentType, startTime: form.startTime, endTime: form.endTime, startMin: sMin, endMin: eMin, count: form.count, instructor: form.instructor, duration: (eMin - sMin) / 60, roomId: form.roomId || null };
              setClasses(prev => [...prev, newClass]);
          };

          // --- Smart Parsing Logic (FIXED) ---
          const parseData = () => {
            if (viewSource !== 'personal') return alert("Read-only mode.");
            const lines = rawInput.split('\n').filter(line => line.trim() !== '');
            const newClasses = []; const failures = [];
            
            lines.forEach((line, index) => {
              try {
                const timeRegex = /\((\d{1,2}:\d{2})~(\d{1,2}:\d{2})\)/;
                const timeMatch = line.match(timeRegex);
                
                let startTime, endTime, startMin, endMin, duration, instructor;
                let type, level, day, period, studentType, count;

                if (timeMatch) {
                    // Case A: Standard Parsing (Time block exists)
                    [_, startTime, endTime] = timeMatch;
                    
                    const preTime = line.substring(0, timeMatch.index).trim(); 
                    const postTime = line.substring(timeMatch.index + timeMatch[0].length).trim(); 
                    const countMatch = postTime.match(/\[(\d+)ëª…\]/);
                    count = countMatch ? countMatch[1] : "0";
                    instructor = postTime.replace(/\[\d+ëª…\]/, '').trim();
                    
                    const parts = preTime.split('_');
                    type = parts[0] || "Unknown";
                    
                    const dayCharRegex = /[ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼]/;
                    let dayPartIndex = -1;
                    for (let i = parts.length - 1; i >= 0; i--) { if (dayCharRegex.test(parts[i])) { dayPartIndex = i; break; } }
                    if (dayPartIndex === -1) throw new Error("Day not found");
                    
                    day = parts[dayPartIndex].match(/([ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼])/)[1];
                    const periodMatch = parts[dayPartIndex].match(/([ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼])(\d*)/);
                    period = periodMatch ? periodMatch[2] : "";
                    
                    const stMatch = parts[dayPartIndex].match(/\(([A-Za-z]+)\)/);
                    studentType = stMatch ? stMatch[1] : "";

                    if (dayPartIndex > 0) { 
                        if (dayPartIndex > 1) { level = parts.slice(1, dayPartIndex).join('_'); } 
                        else { level = parts[1] === parts[dayPartIndex] ? "" : parts[1]; } 
                    } else { type = "General"; level = "General"; }

                    const sParts = startTime.split(':').map(Number); const eParts = endTime.split(':').map(Number);
                    startMin = sParts[0] * 60 + sParts[1]; endMin = eParts[0] * 60 + eParts[1];
                    duration = (endMin - startMin) / 60;
                } else {
                    // Case B: Flexible Parsing (No Time Block) -> Infer from Period & Instructor Prefs
                    let tempLine = line.trim();
                    const countMatch = tempLine.match(/\[(\d+)ëª…\]/);
                    count = countMatch ? countMatch[1] : "0";
                    
                    let noCountLine = tempLine.replace(/\[\d+ëª…\]/, '').trim();
                    const parts = noCountLine.split('_');
                    type = parts[0] || "Unknown";
                    
                    const dayCharRegex = /[ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼]/;
                    let dayPartIndex = -1;
                    for (let i = parts.length - 1; i >= 0; i--) { if (dayCharRegex.test(parts[i])) { dayPartIndex = i; break; } }
                    if (dayPartIndex === -1) throw new Error("Day not found");
                    
                    const dayPartRaw = parts[dayPartIndex]; 
                    const dayTokenMatch = dayPartRaw.match(/^([ì›”í™”ìˆ˜ëª©ê¸ˆí† ì¼])(\d*)(\([A-Za-z]+\))?(.*)$/);
                    
                    if (!dayTokenMatch) throw new Error("Invalid Day format");
                    
                    day = dayTokenMatch[1];
                    period = dayTokenMatch[2];
                    studentType = dayTokenMatch[3] ? dayTokenMatch[3].replace(/[()]/g, '') : "";
                    let potentialInstructor = dayTokenMatch[4].trim();
                    
                    if (dayPartIndex > 0) {
                        if (dayPartIndex > 1) { level = parts.slice(1, dayPartIndex).join('_'); } 
                        else { level = parts[1] === parts[dayPartIndex] ? "" : parts[1]; }
                    } else { level = "General"; }

                    const suffixParts = parts.slice(dayPartIndex + 1);
                    instructor = (potentialInstructor + " " + suffixParts.join("_")).trim();
                    
                    // FIX: Clean unwanted numeric prefix (e.g., "2 Holley Bailey" -> "Holley Bailey")
                    instructor = instructor.replace(/^\d+\s+/, '');
                    
                    if (!period) throw new Error("No period found for time inference");
                    
                    const pNum = parseInt(period);
                    const startH = 12 + pNum; 
                    startMin = startH * 60;
                    startTime = `${startH}:00`;
                    
                    const prefDur = parseFloat(instructorDurations[instructor]); 
                    duration = !isNaN(prefDur) ? prefDur : 1.5; 
                    
                    endMin = startMin + (duration * 60);
                    const endH = Math.floor(endMin / 60);
                    const endM = endMin % 60;
                    endTime = `${endH}:${endM.toString().padStart(2, '0')}`;
                }

                newClasses.push({ id: `cls-${Date.now()}-${index}`, raw: line, type, level: level || type, day, period, studentType, startTime, endTime, startMin, endMin, count, instructor, duration, roomId: null });
              } catch (err) { failures.push(line); console.log(err);}
            });
            setClasses(newClasses); setFailedLines(failures); setParseError(failures.length > 0 ? `${failures.length} lines failed.` : null);
          };
          
          const autoAssignClasses = () => { /* (Same Logic) */
            if (viewSource !== 'personal') return alert("Read-only mode.");
            let assignedCount = 0; let conflictCount = 0; let noPrefCount = 0; let currentClasses = [...classes];
            const unassigned = currentClasses.filter(c => !c.roomId);
            unassigned.forEach(cls => {
              const prefRoom = instructorPrefs[cls.instructor];
              if (!prefRoom || !rooms.includes(prefRoom)) { noPrefCount++; return; }
              const hasConflict = currentClasses.some(existing => existing.roomId === prefRoom && existing.day === cls.day && existing.id !== cls.id && cls.startMin < existing.endMin && cls.endMin > existing.startMin);
              if (!hasConflict) { const index = currentClasses.findIndex(c => c.id === cls.id); if (index !== -1) { currentClasses[index] = { ...currentClasses[index], roomId: prefRoom }; assignedCount++; } } else { conflictCount++; }
            });
            showToast(`âœ¨ Assigned: ${assignedCount}, Skipped: ${conflictCount}`); setClasses(currentClasses);
          };
          const startEditing = useCallback((cls) => { if (viewSource !== 'personal') return; setEditingClassId(cls.id); setEditForm({ ...cls }); }, [viewSource]);
          const cancelEditing = useCallback(() => { setEditingClassId(null); setEditForm({}); }, []);
          const saveEditing = useCallback(() => { setClasses(prev => prev.map(c => { if (c.id === editingClassId) { const sParts = editForm.startTime.split(':').map(Number); const eParts = editForm.endTime.split(':').map(Number); const sMin = sParts[0] * 60 + sParts[1]; const eMin = eParts[0] * 60 + eParts[1]; return { ...editForm, startMin: sMin, endMin: eMin, duration: (eMin - sMin) / 60 }; } return c; })); setEditingClassId(null); setEditForm({}); }, [editingClassId, editForm]);
          const handleEditChange = useCallback((field, value) => { setEditForm(prev => ({ ...prev, [field]: value })); }, []);
          const assignRoom = useCallback((classId, roomId) => { if (viewSource !== 'personal') return; setClasses(prev => prev.map(cls => cls.id === classId ? { ...cls, roomId } : cls)); }, [viewSource]);
          const deleteClass = useCallback((classId) => { if (viewSource !== 'personal') return; if(confirm("Delete class?")) { setClasses(prev => prev.filter(c => c.id !== classId)); } }, [viewSource]);
          const generateColor = (str) => { if (!str) return '#FFFFFF'; let hash = 0; for (let i = 0; i < str.length; i++) { hash = str.charCodeAt(i) + ((hash << 5) - hash); } return PASTEL_PALETTE[Math.abs(hash % PASTEL_PALETTE.length)]; };
          const getClassStyle = useCallback((cls) => { let bg = '#ffffff'; let color = '#000000'; if (colorScheme === 'instructor') { bg = generateColor(cls.instructor); } else if (colorScheme === 'level') { bg = generateColor(cls.level); } else { if (cls.type === 'CDI') { bg = '#eff6ff'; color = '#1e3a8a'; } else { bg = '#ecfdf5'; color = '#064e3b'; } } return { backgroundColor: bg, color: color }; }, [colorScheme]);
          const addRoom = () => { if (viewSource !== 'personal') return; if (newRoomName.trim() && !rooms.includes(newRoomName.trim())) { setRooms([...rooms, newRoomName.trim()]); setNewRoomName(''); } };
          const removeRoom = (roomName) => { if (viewSource !== 'personal') return; if(confirm(`Delete room '${roomName}'?`)) { setRooms(rooms.filter(r => r !== roomName)); setClasses(prev => prev.map(cls => cls.roomId === roomName ? { ...cls, roomId: null } : cls)); } };

          // Copy Functions
          const copyToClipboardWithStyle = (targetDay) => {
              const timeSlots = [];
              for(let h = START_HOUR; h < END_HOUR; h++) { timeSlots.push({ label: `${h.toString().padStart(2,'0')}:00`, min: h * 60 }); timeSlots.push({ label: `${h.toString().padStart(2,'0')}:30`, min: h * 60 + 30 }); }
              let fullHtml = "";
              const daysToExport = targetDay === 'ALL' ? DAYS : [targetDay];
              daysToExport.forEach(d => {
                  if (targetDay === 'ALL') fullHtml += `<h2 style="font-family: sans-serif; color: #333;">${DAY_MAP[d]} Schedule</h2>`;
                  let html = `<table border="1" style="border-collapse: collapse; text-align: center; font-family: sans-serif; font-size: 12px; margin-bottom: 20px;"><thead><tr><th style="background-color: #e5e7eb; width: 80px; height: 30px;">Time / Room</th>`;
                  rooms.forEach(r => { html += `<th style="background-color: #e5e7eb; width: 120px;">${r}</th>`; });
                  html += `</tr></thead><tbody>`;
                  const skipMap = {}; 
                  timeSlots.forEach((slot, tIdx) => {
                      html += `<tr><td style="background-color: #f3f4f6; font-weight: bold; height: 30px;">${slot.label}</td>`;
                      rooms.forEach((room, rIdx) => {
                          const mapKey = `${rIdx}-${tIdx}`;
                          if (skipMap[mapKey]) return; 
                          const cls = classes.find(c => c.day === d && c.roomId === room && Math.abs(c.startMin - slot.min) < 1);
                          if (cls) {
                              const rowSpan = Math.ceil(cls.duration * 2); const style = getClassStyle(cls);
                              html += `<td rowspan="${rowSpan}" style="background-color: ${style.backgroundColor}; color: ${style.color}; border: 1px solid #d1d5db; padding: 4px; vertical-align: middle;"><div style="font-weight: bold; font-size: 13px;">${cls.level}</div><div style="font-size: 11px;">${cls.instructor}</div><div style="font-size: 10px; opacity: 0.8;">${cls.studentType} (${cls.count})</div></td>`;
                              for(let i = 1; i < rowSpan; i++) { skipMap[`${rIdx}-${tIdx + i}`] = true; }
                          } else { html += `<td style="border: 1px solid #e5e7eb;"></td>`; }
                      });
                      html += `</tr>`;
                  });
                  html += `</tbody></table>`;
                  fullHtml += html;
              });
              const blobHtml = new Blob([fullHtml], { type: 'text/html' }); const blobText = new Blob(["HTML Format"], { type: 'text/plain' });
              navigator.clipboard.write([new ClipboardItem({ "text/html": blobHtml, "text/plain": blobText })]).then(() => showToast(`ğŸ“‹ Copied Excel format`));
          };
          const exportAsRawString = () => { const lines = classes.map(cls => `${cls.type}_${cls.level}_${cls.day}${cls.period || ''}(${cls.studentType}) (${cls.startTime}~${cls.endTime}) [${cls.count}ëª…] ${cls.instructor}`); navigator.clipboard.writeText(lines.join('\n')).then(() => showToast("ğŸ“ Raw string copied!")); };
          const copyDataForEmbedding = () => { 
              // Export Durations as well
              const data = { version: Date.now(), rawInput, classes, rooms, instructorPrefs, instructorDurations }; 
              navigator.clipboard.writeText(JSON.stringify(data)).then(() => showToast("ğŸ“¦ Embedding Code Copied!")); 
          };

          const unassignedClasses = classes.filter(c => !c.roomId);
          const instructorStats = useMemo(() => {
            const stats = {}; classes.forEach(cls => { const name = cls.instructor.trim(); if (!stats[name]) { stats[name] = { count: 0, hours: 0 }; } stats[name].count += 1; stats[name].hours += cls.duration; });
            return Object.entries(stats).sort((a, b) => b[1].hours - a[1].hours);
          }, [classes]);
          const allInstructors = useMemo(() => { const names = new Set(classes.map(c => c.instructor)); return Array.from(names).sort(); }, [classes]);

          return (
            <div className="min-h-screen bg-gray-100 text-gray-800 font-sans relative">
              {!licenseAgreed && <LicenseModal onAgree={() => setLicenseAgreed(true)} />}
              {showAddClassModal && <AddClassModal onClose={() => setShowAddClassModal(false)} onAdd={handleAddManualClass} rooms={rooms} />}
              <div className={`fixed top-4 left-1/2 transform -translate-x-1/2 z-[100] transition-all duration-300 ${toast.show ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-4 pointer-events-none'}`}><div className="bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg text-sm font-medium flex items-center gap-2"><span>ğŸ’¾</span> {toast.message}</div></div>
              {showClearModal && (<div className="fixed inset-0 z-[999] flex items-center justify-center modal-backdrop"><div className="absolute inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm"></div><div className="bg-white p-6 rounded-xl shadow-2xl z-10 max-w-md w-full mx-4 border border-gray-200 relative"><h2 className="text-xl font-bold text-red-600 mb-2 flex items-center gap-2"><Icon path={ICONS.alertCircle} size={24} /> Warning: Clear All Data</h2><p className="text-gray-600 mb-6">All data will be lost.</p><div className="flex justify-end gap-3"><button onClick={() => setShowClearModal(false)} className="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors">Cancel</button><button onClick={confirmReset} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-colors shadow-md">Clear</button></div></div></div>)}
              {showImportExportModal && (
                  <div className="fixed inset-0 z-[100] flex items-center justify-center p-4"><div className="absolute inset-0 bg-black/30 backdrop-blur-sm" onClick={() => setShowImportExportModal(false)}></div><div className="bg-white w-full max-w-2xl rounded-xl shadow-2xl z-10 flex flex-col max-h-[85vh]"><div className="p-4 border-b border-gray-100 flex justify-between items-center bg-indigo-50 rounded-t-xl"><h2 className="font-bold text-lg text-indigo-800 flex items-center gap-2"><Icon path={ICONS.table} size={20} /> Data Export</h2><button onClick={() => setShowImportExportModal(false)} className="p-1 hover:bg-indigo-100 rounded-full text-indigo-400"><Icon path={ICONS.x} size={20} /></button></div>
                      <div className="p-6 overflow-y-auto">
                          <div className="mb-6"><h3 className="text-sm font-bold text-gray-700 mb-2">1. Raw String Export (Backup)</h3><p className="text-xs text-gray-500 mb-3">Export current data as parseable raw strings.</p><button onClick={exportAsRawString} className="w-full flex items-center justify-center gap-2 px-4 py-3 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 rounded-lg text-sm font-medium shadow-sm transition-colors"><Icon path={ICONS.code} size={16} /> Copy Raw String</button></div>
                          <hr className="my-6 border-gray-100" />
                          <div className="mb-2 bg-red-50 border border-red-200 rounded-lg p-4 relative overflow-hidden"><div className="absolute top-0 left-0 w-1 h-full bg-red-400"></div><h3 className="text-sm font-bold text-red-800 mb-2 flex items-center gap-2"><Icon path={ICONS.alertCircle} size={16} /> Danger Zone: Deployment Export</h3><p className="text-xs text-red-600 mb-3 leading-relaxed"><strong>Advanced Users Only.</strong><br/>Generate embeddable code for distribution.</p><button onClick={copyDataForEmbedding} className="w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 border border-red-300 rounded-lg text-sm font-medium shadow-sm transition-colors"><Icon path={ICONS.code} size={16} /> Copy Embedding Code</button></div>
                      </div></div></div>
              )}
              {showPrefModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4">
                  <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg flex flex-col max-h-[80vh]">
                    <div className="p-4 border-b border-gray-200 flex justify-between items-center"><h2 className="font-bold text-lg flex items-center gap-2"><span className="text-indigo-600"><Icon path={ICONS.settings} size={20} /></span> Instructor Settings</h2><button onClick={() => setShowPrefModal(false)} className="p-1 hover:bg-gray-100 rounded-full"><Icon path={ICONS.x} size={20} className="text-gray-500" /></button></div>
                    <div className="p-4 overflow-y-auto flex-1">
                      {allInstructors.length === 0 ? <p className="text-center text-gray-400 py-8">No info</p> : <div className="space-y-3">{allInstructors.map(name => (
                          <div key={name} className="flex justify-between items-center text-sm border p-2 rounded bg-gray-50">
                              <span className="font-medium text-gray-800 w-1/3 truncate" title={name}>{name}</span>
                              <div className="flex gap-2 w-2/3">
                                  <input 
                                    type="number" 
                                    step="0.5"
                                    placeholder="Dur(h)" 
                                    className="border rounded p-1.5 w-20 text-center text-xs" 
                                    value={instructorDurations[name] || ""} 
                                    onChange={(e) => setInstructorDurations(prev => ({ ...prev, [name]: parseFloat(e.target.value) }))}
                                    title="Preferred Duration (hours)"
                                  />
                                  <select 
                                    className="border rounded p-1.5 flex-1 text-xs bg-white" 
                                    value={instructorPrefs[name] || ""} 
                                    onChange={(e) => setInstructorPrefs(prev => ({ ...prev, [name]: e.target.value }))}
                                  >
                                    <option value="">-- Room --</option>{rooms.map(r => <option key={r} value={r}>{r}</option>)}
                                  </select>
                              </div>
                          </div>
                      ))}</div>}
                    </div>
                    <div className="p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl flex justify-end gap-2"><button onClick={() => setShowPrefModal(false)} className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition-colors">Done</button></div>
                  </div>
                </div>
              )}

              {/* HEADER - FINAL IMPROVED UI - REMOVED BUTTONS FROM HEADER */}
              <header className="bg-indigo-700 text-white p-4 shadow-md sticky top-0 z-50">
                <div className="max-w-7xl mx-auto flex items-center justify-center">
                    <div className="flex items-center gap-2">
                        <Icon path={ICONS.bookOpen} size={24} />
                        <h1 className="text-xl font-bold whitespace-nowrap">School Timetable Manager</h1>
                    </div>
                </div>
                {/* Read Only Banner */}
                {viewSource === 'distributed' && (
                    <div className="bg-yellow-100 text-yellow-800 text-center text-xs py-1 font-bold mt-2 rounded max-w-7xl mx-auto">
                        âš ï¸ Read-Only Mode (Distributed Version). Switch to 'Personal' to edit.
                    </div>
                )}
              </header>

              <main className="min-w-full p-4 flex justify-center">
                {/* MAIN CONTAINER: Left Sidebar - Content - Right Sidebar */}
                <div className="w-full flex gap-4 justify-between max-w-[1920px]"> {/* Ultra Wide Support */}
                    
                    {/* 1. LEFT SIDEBAR (Navigation) - Fixed Position Logic Simulated with Sticky */}
                    <div className="w-48 flex-shrink-0 flex flex-col gap-4 sticky top-20 h-fit">
                        {/* Source Toggle */}
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-2 flex flex-col gap-2">
                            <span className="text-[10px] font-bold text-gray-400 uppercase px-2">Source</span>
                            <button onClick={() => setViewSource('personal')} className={`px-3 py-2 rounded-lg text-sm font-medium text-left transition-all flex flex-col ${viewSource === 'personal' ? 'bg-indigo-50 text-indigo-700 border border-indigo-100' : 'text-gray-600 hover:bg-gray-50'}`}>
                                <span>Personal</span>
                                <span className="text-[9px] opacity-60">{formatTime(localStorage.getItem(STORAGE_KEYS.VERSION)).split(' ').pop()}</span>
                            </button>
                            <button onClick={() => setViewSource('distributed')} className={`px-3 py-2 rounded-lg text-sm font-medium text-left transition-all flex flex-col ${viewSource === 'distributed' ? 'bg-indigo-50 text-indigo-700 border border-indigo-100' : 'text-gray-600 hover:bg-gray-50'}`}>
                                <span>Distributed</span>
                                <span className="text-[9px] opacity-60">{formatTime(distVersion).split(' ').pop()}</span>
                            </button>
                            
                            {/* NEW: Load Distributed Button (Only in Personal) */}
                            {viewSource === 'personal' && PRELOADED_DATA && (
                                <button 
                                    onClick={resetToDistributed} 
                                    className="mt-1 px-2 py-1.5 bg-yellow-50 hover:bg-yellow-100 text-yellow-700 text-xs rounded border border-yellow-200 flex items-center justify-center gap-1 transition-colors"
                                    title="Overwrite personal data with distributed version"
                                >
                                    <Icon path={ICONS.refresh} size={12} /> Load Distributed
                                </button>
                            )}
                        </div>

                        {/* View Toggle */}
                        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-2 flex flex-col gap-2">
                            <span className="text-[10px] font-bold text-gray-400 uppercase px-2">View</span>
                            <button onClick={() => setViewMode('dashboard')} className={`px-3 py-2 rounded-lg text-sm font-medium text-left transition-all ${viewMode === 'dashboard' ? 'bg-indigo-50 text-indigo-700 border border-indigo-100' : 'text-gray-600 hover:bg-gray-50'}`}>Dashboard</button>
                            <button onClick={() => setViewMode('weekly')} className={`px-3 py-2 rounded-lg text-sm font-medium text-left transition-all ${viewMode === 'weekly' ? 'bg-indigo-50 text-indigo-700 border border-indigo-100' : 'text-gray-600 hover:bg-gray-50'}`}>Weekly</button>
                        </div>
                    </div>

                    {/* 2. CENTER CONTENT (Flexible) */}
                    <div className="flex-1 min-w-0">
                        {/* --- DASHBOARD VIEW --- */}
                        {viewMode === 'dashboard' && (
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6">
                                <div className="lg:col-span-3 space-y-6">
                                  <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                                    <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-2"><Icon path={ICONS.monitor} size={18} /> Raw Data Input</h2>
                                    <textarea disabled={viewSource !== 'personal'} className={`w-full h-40 p-3 text-xs font-mono border rounded-md focus:ring-2 focus:ring-indigo-500 outline-none resize-none ${viewSource !== 'personal' ? 'bg-gray-100 text-gray-500 cursor-not-allowed' : 'bg-slate-50'}`} placeholder="Paste strings here..." value={rawInput} onChange={(e) => setRawInput(e.target.value)}></textarea>
                                    <div className="flex justify-between items-center mt-2"><button onClick={parseData} disabled={viewSource !== 'personal'} className={`w-full text-white py-2 rounded-md text-sm font-medium transition-colors flex justify-center items-center gap-2 ${viewSource !== 'personal' ? 'bg-gray-400 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700'}`}><Icon path={ICONS.save} size={16} /> Parse Schedule</button></div>
                                    {parseError && <div className="mt-3 bg-red-50 rounded border border-red-200 overflow-hidden"><div className="p-2 bg-red-100 text-red-800 text-xs font-bold flex items-center gap-2"><Icon path={ICONS.xCircle} size={14} /> {parseError}</div><div className="max-h-32 overflow-y-auto p-2"><ul className="space-y-1">{failedLines.map((line, idx) => <li key={idx} className="text-[10px] text-red-600 font-mono bg-white border border-red-100 p-1 rounded break-all">{line}</li>)}</ul></div></div>}
                                  </div>
                                  <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200 h-[500px] flex flex-col">
                                    <div className="flex justify-between items-center mb-3">
                                        <h2 className="font-bold text-gray-700 flex items-center gap-2"><Icon path={ICONS.alertCircle} size={18} className="text-orange-500" /> Unassigned Lectures</h2>
                                        <div className="flex items-center gap-2">
                                            <button onClick={() => setShowAddClassModal(true)} disabled={viewSource !== 'personal'} className={`p-1 px-2 rounded bg-indigo-100 text-indigo-700 hover:bg-indigo-200 transition-colors flex items-center gap-1 ${viewSource !== 'personal' && 'opacity-50 cursor-not-allowed'}`} title="Add New Lecture"><Icon path={ICONS.plus} size={14} /><span className="text-xs font-bold">New</span></button>
                                            <span className="text-xs bg-gray-200 px-2 py-0.5 rounded-full">{unassignedClasses.length}</span>
                                        </div>
                                    </div>
                                    {unassignedClasses.length > 0 && <button onClick={autoAssignClasses} disabled={viewSource !== 'personal'} className={`mb-3 w-full text-white text-xs font-bold py-2 rounded-lg shadow-sm flex items-center justify-center gap-2 transition-all active:scale-95 ${viewSource !== 'personal' ? 'bg-gray-400 cursor-not-allowed' : 'bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600'}`}><Icon path={ICONS.wand2} size={14} /> Magic Auto-Assign</button>}
                                    <div className="overflow-y-auto flex-1 space-y-3 pr-1">
                                      {unassignedClasses.length === 0 ? <p className="text-xs text-gray-400 text-center mt-10">No unassigned classes.</p> : unassignedClasses.map(cls => (
                                        <ClassCard key={cls.id} cls={cls} isEditing={editingClassId === cls.id} editForm={editForm} onEditStart={startEditing} onEditCancel={cancelEditing} onEditSave={saveEditing} onEditChange={handleEditChange} onAssignRoom={assignRoom} onDeleteClass={deleteClass} rooms={rooms} getClassStyle={getClassStyle} readOnly={viewSource !== 'personal'} />
                                      ))}
                                    </div>
                                  </div>
                                </div>
                                <div className="lg:col-span-6">
                                    <div className="flex bg-gray-100 p-1 rounded-lg overflow-x-auto no-scrollbar mb-4">
                                      {DAYS.map(day => (<button key={day} onClick={() => setActiveDay(day)} className={`px-3 py-1.5 text-sm font-medium rounded-md transition-all whitespace-nowrap ${activeDay === day ? 'bg-white text-indigo-600 shadow-sm' : 'text-gray-500 hover:text-gray-700'}`}>{day}</button>))}
                                    </div>
                                    <div style={{ height: '600px' }}>
                                        <DayTimetable 
                                            day={activeDay} 
                                            rooms={rooms} 
                                            classes={classes} 
                                            onAssignRoom={assignRoom} 
                                            getClassStyle={getClassStyle} 
                                            readOnly={viewSource !== 'personal'} 
                                            onExportExcel={copyToClipboardWithStyle}
                                            colorScheme={colorScheme}
                                            setColorScheme={setColorScheme}
                                        />
                                    </div>
                                </div>
                                <div className="lg:col-span-3 space-y-6">
                                  <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                                    <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-3"><Icon path={ICONS.monitor} size={18} /> Rooms</h2>
                                    <div className="flex gap-2 mb-4"><input type="text" placeholder="New Room..." disabled={viewSource !== 'personal'} className="flex-1 p-2 text-sm border rounded outline-none focus:border-indigo-500 disabled:bg-gray-100" value={newRoomName} onChange={(e) => setNewRoomName(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && addRoom()} /><button onClick={addRoom} disabled={viewSource !== 'personal'} className={`text-white p-2 rounded ${viewSource !== 'personal' ? 'bg-gray-400' : 'bg-green-600 hover:bg-green-700'}`}><Icon path={ICONS.plus} size={18} /></button></div>
                                    <div className="space-y-2 max-h-40 overflow-y-auto">{rooms.map(room => (<div key={room} className="flex justify-between items-center text-sm bg-gray-50 p-2 rounded border border-gray-100"><span>{room}</span><button onClick={() => removeRoom(room)} disabled={viewSource !== 'personal'} className={`hover:text-red-600 ${viewSource !== 'personal' ? 'text-gray-300 cursor-not-allowed' : 'text-red-400'}`} title="Delete Room"><Icon path={ICONS.trash2} size={14} /></button></div>))}</div>
                                  </div>
                                  <div className="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                                    <h2 className="font-bold text-gray-700 flex items-center gap-2 mb-4"><Icon path={ICONS.barChart2} size={18} /> Instructor Hours</h2>
                                    <div className="overflow-x-auto">
                                      <table className="w-full text-sm text-left">
                                        <thead className="text-xs text-gray-500 uppercase bg-gray-50"><tr><th className="px-2 py-2">Name</th><th className="px-2 py-2 text-center">Classes</th><th className="px-2 py-2 text-right">Hrs</th></tr></thead>
                                        <tbody className="divide-y divide-gray-100">
                                          {instructorStats.length === 0 ? <tr><td colSpan="3" className="p-4 text-center text-gray-400 text-xs">No data parsed yet.</td></tr> : instructorStats.map(([name, data]) => (
                                              <tr key={name} className="hover:bg-gray-50"><td className="px-2 py-2 font-medium text-gray-800 truncate max-w-[100px]" title={name}>{name}</td><td className="px-2 py-2 text-center text-gray-500">{data.count}</td><td className="px-2 py-2 text-right font-bold text-indigo-600">{data.hours.toFixed(1)}</td></tr>
                                          ))}
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                </div>
                            </div>
                        )}
                        
                        {/* --- WEEKLY VIEW --- */}
                        {viewMode === 'weekly' && (
                            <div className="relative">
                                <div className="absolute top-0 right-0 z-20 p-2">
                                    <button onClick={() => copyToClipboardWithStyle('ALL')} className="flex items-center gap-1 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium shadow-md transition-colors"><Icon path={ICONS.download} size={16} /><span>Copy Weekly Excel</span></button>
                                </div>
                                <div className="space-y-8 pt-12">
                                    {DAYS.map(day => (
                                        <div key={day} className="w-full h-[600px]">
                                            <DayTimetable 
                                                day={day} 
                                                rooms={rooms} 
                                                classes={classes} 
                                                onAssignRoom={assignRoom} 
                                                getClassStyle={getClassStyle} 
                                                fullWidth={true} 
                                                readOnly={viewSource !== 'personal'} 
                                                onExportExcel={copyToClipboardWithStyle}
                                                colorScheme={colorScheme}
                                                setColorScheme={setColorScheme}
                                            />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </div>

                    {/* 3. RIGHT SIDEBAR (Actions) - Fixed Position Logic Simulated with Sticky */}
                    <div className="w-48 flex-shrink-0 flex flex-col gap-4 sticky top-20 h-fit">
                         {/* Data/File */}
                         <button onClick={() => setShowImportExportModal(true)} className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl shadow-sm transition-all hover:shadow-md group">
                             <div className="p-1.5 bg-white/20 rounded-lg group-hover:bg-white/30 transition-colors"><Icon path={ICONS.table} size={18} /></div>
                             <span className="font-medium text-sm">Data/File</span>
                         </button>
                         
                         {/* Preferences */}
                         <button onClick={() => setShowPrefModal(true)} className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-white border border-purple-100 hover:border-purple-300 text-purple-700 rounded-xl shadow-sm transition-all hover:shadow-md group">
                            <div className="p-1.5 bg-purple-50 text-purple-600 rounded-lg group-hover:bg-purple-100 transition-colors"><Icon path={ICONS.settings} size={18} /></div>
                            <span className="font-medium text-sm">Preferences</span>
                         </button>

                         {/* Divider */}
                         <div className="h-px w-full bg-gray-200 my-2"></div>

                         {/* Clear */}
                         <button onClick={() => setShowClearModal(true)} className="w-full flex items-center justify-start gap-3 px-4 py-3 bg-white border border-red-100 hover:bg-red-50 text-red-600 rounded-xl shadow-sm transition-all hover:shadow-md group" title="Clear All Data">
                           <div className="p-1.5 bg-red-50 text-red-500 rounded-lg group-hover:bg-red-100 transition-colors"><Icon path={ICONS.trash2} size={18} /></div>
                           <span className="font-medium text-sm">Clear</span>
                         </button>
                    </div>

                </div>
              </main>
            </div>
          );
        };

        const container = document.getElementById('root');
        if (container) {
          const root = ReactDOM.createRoot(container);
          root.render(<App />);
        }
    </script>
</body>
</html>
